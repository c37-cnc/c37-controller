/**
 *
 * C37 - Controller - Desktop in Mon Mar 20 2017 17:50:40 GMT-0300 (BRT)
 *
 * c37-controller-desktop - C37 - Controlador - Desktop
 * @version 0.0.225
 * @link https://controller.c37.co/
 * @license CC BY-NC-ND 4.0
 *
 */
"use strict";function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var t=function(){function e(e,t){var n=[],i=!0,a=!1,o=void 0;try{for(var s,r=e[Symbol.iterator]();!(i=(s=r.next()).done)&&(n.push(s.value),!t||n.length!==t);i=!0);}catch(e){a=!0,o=e}finally{try{!i&&r.return&&r.return()}finally{if(a)throw o}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),n=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();!function(e,t){function n(e){var t=.1;e.style.display="block";var n=setInterval(function(){t>=1&&clearInterval(n),e.style.opacity=t,e.style.filter="alpha(opacity="+100*t+")",t+=.1*t},10)}var i=require("os"),a=!1,o={name:"C37-CONTROLLER",debug:!1,version:1,stores:{settings:{uuid:{type:"string",index:!0},value:{type:"string",index:!1}}}},s={debug:!a,load:"current",cookieName:"lang",fallbackLng:"pt-BR",useLocalStorage:!!a,localStorageExpirationTime:2592e5},r={cpus:i.cpus(),arch:i.arch(),freemem:i.freemem(),totalmem:i.totalmem(),platform:i.platform(),release:i.release(),type:i.type(),networkInterfaces:i.networkInterfaces(),userInfo:i.userInfo()},d={initialize:function(e){t.manager.initialize(o,function(i){if(!i){t.operation.get("settings","i18n",function(e,t){if(e||!t)return i18n.init(s,function(e,t){i18n.translateObject(document),document.getElementsByTagName("html")[0].setAttribute("lang",i18n.lng())}),void document.getElementById("option-group-i18n").setSelected(i18n.lng());var n=t.value;document.getElementById("option-group-i18n").setSelected(n),i18n.setLng(n,s,function(e,t){i18n.translateObject(document),document.getElementsByTagName("html")[0].setAttribute("lang",i18n.lng())})});var a={viewPort:document.querySelector("main"),computer:r,i18n:s};return d.viewer.initialize(a),d.interface.initialize(a),d.gcode.initialize(a),d.probe.initialize(a),setTimeout(function(){n(document.body)},100),!e||e(!0)}throw new Error("Application - Initialize - Failed to Initialize the Local Database \n http://controller.c37.co/docs/errors.html#application-initialize")})},reset:function(e){return!e||e(!0)}};e.c37=e.c37||{},e.c37.application=e.c37.application||{},e.c37.application.controller=d,e.onload=function(){e.c37.application.controller.initialize(function(e){if(e)return!0;throw new Error("application initialize - error")})},e.onerror=function(e,t,n,i,a){var o="<strong>message:</strong> "+e+"<br><strong>source:</strong> "+t+"<br><strong>lineno:</strong> "+n+" <strong>colno:</strong> "+i,s=JSON.stringify(a);c37.library.message.operation.add({type:"error",text:o,detail:s})},"toJSON"in Error.prototype||Object.defineProperty(Error.prototype,"toJSON",{value:function(){var e={};return Object.getOwnPropertyNames(this).forEach(function(t){e[t]=this[t]},this),e},configurable:!0,writable:!0})}(window,c37.library.database),function(e,t,n){function i(e){var t,i=!0,s=new n.BoundingBoxHelper(e,16711680);s.update(),y=s;var r="#0d0d0d",d=new n.LineDashedMaterial({vertexColors:!1,color:r,dashSize:1,gapSize:1,linewidth:1,transparent:!0,opacity:.3}),c=0,l=-4,u=5,p=s.box.min.x,g=s.box.min.y,f=s.box.max.x,h=s.box.max.y,b=s.box.min.z,v=s.box.max.z,x=new n.Geometry;x.vertices.push(new n.Vector3(p,g+l,c),new n.Vector3(p,g+l-u,c),new n.Vector3(p,g+l-u,c),new n.Vector3(f,g+l-u,c),new n.Vector3(f,g+l-u,c),new n.Vector3(f,g+l,c)),x.computeLineDistances();var E=new n.Line(x,d,n.LineSegments);E.type=n.Lines;var w="X "+(f-p).toFixed(2);w+=i?" mm":" in";var L=o({x:p+1,y:g+l-u-3,z:c,text:w,color:r,opacity:.3,size:2}),I=-4,z=new n.Geometry;z.vertices.push(new n.Vector3(p+I,g,c),new n.Vector3(p+I-u,g,c),new n.Vector3(p+I-u,g,c),new n.Vector3(p+I-u,h,c),new n.Vector3(p+I-u,h,c),new n.Vector3(p+I,h,c)),z.computeLineDistances();var B=new n.Line(z,d,n.LineSegments);B.type=n.Lines,w="Y "+(h-g).toFixed(2),w+=i?" mm":" in";var G=o({x:p+I-u,y:g-3,z:c,text:w,color:r,opacity:.3,size:2}),M=new n.Geometry;M.vertices.push(new n.Vector3(f,g,b),new n.Vector3(f+u,g,b),new n.Vector3(f+u,g,b),new n.Vector3(f+u,g,v),new n.Vector3(f+u,g,v),new n.Vector3(f,g,v)),M.computeLineDistances();var T=new n.Line(M,d,n.LineSegments);T.type=n.Lines,w="Z "+(v-b).toFixed(2),w+=i?" mm":" in";var S=o({x:f+I+u,y:g-3,z:c,text:w,color:r,opacity:.3,size:2});S.rotateX(Math.PI/2);var O=S.position;S.position.set(O.x+5,O.y+3,O.z),t=new n.Object3D,t.add(E),t.add(L),t.add(B),t.add(G),t.add(T),t.add(S);var C=e.userData.lines,R=C[C.length-1].p2,H=a(R.timeMinsSum);w="Tempo Estimado: "+H+", Distancia Total: "+R.distSum.toFixed(2),w=i?w+" mm":w+" in";var $=o({x:p+1,y:g+l-u-6,z:c,text:w,color:r,opacity:.3,size:2});t.add($),m.add(t),k.push(t)}function a(e){var t=60*e,n=~~(t/3600);e=~~(t%3600/60);var i=t%60,a="";return n>0&&(a+=""+n+"h "+(e<10?"0":"")),a+=""+e+"m "+(i<10?"0":""),a+=""+i.toFixed(0)+"s"}function o(e){var t,i,a,o;return n.FontUtils?(n.FontUtils.loadFace(ThreeHelvetiker),t=n.FontUtils.generateShapes(e.text,{font:"helvetiker",size:e.size?e.size:10}),i=new n.ShapeGeometry(t),a=new n.MeshBasicMaterial({color:e.color,transparent:!0,opacity:e.opacity?e.opacity:.5}),o=new n.Mesh(i,a),o.position.x=e.x,o.position.y=e.y,o.position.z=e.z,o):void console.error("THREE.FontUtils not defined per bug in r73 of three.js. So not making text.")}function s(){p.render(m,u),setTimeout(function(){requestAnimationFrame(s)},100)}function r(e){"ia32"!==T.arch&&"x32"!==T.arch&&v.position.set(e.x,e.y,e.z)}function d(){if(k.length>0)for(var e=0;e<k.length;e++)m.remove(k[e]),G.remove(k[e]);c(h)}function c(e){if("ia32"!==T.arch&&"x32"!==T.arch){e?M=e:e=M,e||(e=new n.GridHelper(z,B,10));var t=new n.BoundingBoxHelper(e,16711680);t.update();var i,a=t.box.min.x,o=t.box.min.y,s=t.box.max.x,r=t.box.max.y,d=t.box.min.z,c=t.box.max.z;e.userData&&e.userData.center2?(i=e.userData,i.bbox2=t.box,i.center2.x=a+(s-a)/2,i.center2.y=o+(r-o)/2,i.center2.z=d+(c-d)/2):(i={},i.center2={},i.center2.x=a+(s-a)/2+z/2,i.center2.y=o+(r-o)/2+B/2,i.center2.z=d+(c-d)/2),"ia32"!==T.arch&&"x32"!==T.arch&&L.reset();var l=s-a,m=r-o,u=c-d,p=Math.max(l,m,u),g=2*p;L.object.position.x=i.center2.x,L.object.position.y=i.center2.y,L.object.position.z=i.center2.z+g,L.target.x=i.center2.x,L.target.y=i.center2.y,L.target.z=i.center2.z;var f=2.2*Math.atan(p/(2*g))*(180/Math.PI);if(!isNaN(f)){L.object.fov=f;var h=g,b=L.object,v=L.target.clone(),y=(new n.Vector3).subVectors(b.position,v).length(),x=b.up.clone(),E=new n.Quaternion;b.translateZ(h-y),x.y=1,x.x=0,x.z=0,E.setFromAxisAngle(x,.5),x.y=0,x.x=1,x.z=0,E.setFromAxisAngle(x,.5),b.position.applyQuaternion(E),x.y=0,x.x=0,x.z=1,E.setFromAxisAngle(x,.5),b.lookAt(v),L.object.updateProjectionMatrix()}}}function l(e,t,i){var a=document.createElement("canvas"),o=a.getContext("2d"),s=null,r=100,d=0,c=7,l=i.text;i.size&&(c=i.size),o.font="normal "+r+"px Arial",s=o.measureText(l),d=s.width,a.width=d,a.height=r,o.font="normal "+r+"px Arial",o.textAlign="center",o.textBaseline="middle",o.fillStyle=i.color,o.fillText(l,d/2,r/2);var m=new n.Texture(a);m.needsUpdate=!0,m.minFilter=n.LinearFilter;var u=new n.SpriteMaterial({map:m,transparent:!0,opacity:.6});u.transparent=!0;var p=new n.Object3D;p.position.x=i.x,p.position.y=i.y,p.position.z=i.z;var g=new n.Sprite(u);return p.textHeight=c,p.textWidth=d/r*p.textHeight,"2d"==t?g.scale.set(p.textWidth/d,p.textHeight/r,1):g.scale.set(d/r*c,c,1),p.add(g),p}var m,u,p,g,f,h,b,v,y,x,E,w,L,I,z,B,G,k=[];x=e.innerWidth,E=e.innerHeight;var M,T,S=1;t.viewer={initialize:function(e){T=e.computer,w=new n.Raycaster,G=new n.Group,"ia32"!==T.arch&&"x32"!==T.arch?(t.viewer.init3D(),s()):c37.library.message.operation.add({type:"info",text:"",i18n:"[html]performance.viewer.text"})},init3D:function(){m=new n.Scene,u=new n.PerspectiveCamera(75,e.innerWidth/e.innerHeight,1,1e4),u.position.z=470;var t=!!e.CanvasRenderingContext2D,i=function(){try{return!!e.WebGLRenderingContext&&!!document.createElement("canvas").getContext("experimental-webgl")}catch(e){return!1}}();i?p=new n.WebGLRenderer({autoClearColor:!0,antialias:!1}):t&&(p=new n.CanvasRenderer),document.getElementById("viewer").appendChild(p.domElement),p.setClearColor(16777215,1),p.clear(),g=document.getElementById("viewer").clientWidth-2,f=document.getElementById("viewer").clientHeight-2,u.aspect=g/f,p.setSize(g,f),u.updateProjectionMatrix(),L=new n.OrbitControls(u,p.domElement),L.target.set(0,0,0),L.enableRotate=!0,L.enableZoom=!0,L.enableKeys=!1,L.mouseButtons={PAN:n.MOUSE.LEFT,ZOOM:n.MOUSE.MIDDLE,ORBIT:n.MOUSE.RIGHT},I=new n.TransformControls(u,p.domElement),I.setMode("translate"),G.add(I);var a=new n.DirectionalLight(16777215);a.position.set(-500,-500,1).normalize(),a.name="Light1;",G.add(a);var o=new n.DirectionalLight(16777215);o.name="Light2",o.position.set(1,0,1).normalize(),G.add(o),z=400,B=400,h=new n.GridHelper(z,B,10),h.setColors(255,7368816),h.position.y=z/2,h.position.x=B/2,h.position.z=0,h.material.opacity=.15,h.material.transparent=!0,h.receiveShadow=!1,this.grid=h,h.name="GridHelper",G.add(h),v=new n.Object3D;var s=(new n.LineBasicMaterial({color:16711680}),new n.Mesh(new n.CylinderGeometry(0,5,40,15,1,!1),new n.MeshPhongMaterial({color:255,specular:255,shininess:100})));s.overdraw=!0,s.rotation.x=-90*Math.PI/180,s.position.z=20,s.material.opacity=.4,s.material.transparent=!0,s.castShadow=!1,v.add(s),v.position.x=0,v.position.y=0,G.add(v);var r=new n.Object3D;b=new n.AxisHelper(100),b.material.transparent=!0,b.material.opacity=.8,b.material.depthWrite=!1,b.position.set(0,0,-1e-4),r.add(b);var d=l(m,"webgl",{x:110,y:0,z:0,text:"X",color:"#ff0000"}),y=l(m,"webgl",{x:0,y:110,z:0,text:"Y",color:"#00ff00"}),x=l(m,"webgl",{x:0,y:0,z:110,text:"Z",color:"#0000ff"});r.add(d),r.add(y),r.add(x),b=r,G.add(b),c(),m.add(G)},reset3D:function(){for(var e=0;e<k.length;e++)m.remove(k[e]),k.splice(e,1);m.updateMatrixWorld(),d()},get scene(){return m},get objectsInScene(){return k},position:r,information:i,locate:c,reset:d,zoom:{more:function(){S+=.08,u.zoom=S,u.updateProjectionMatrix()},less:function(){S-=.08,S>0?(u.zoom=S,u.updateProjectionMatrix(),console.log(S)):S+=.08}}},e.onresize=function(){g=document.getElementById("viewer").clientWidth-10,f=document.getElementById("viewer").clientHeight-10,p&&u&&(p.setSize(g,f),u.aspect=g/f,u.updateProjectionMatrix())}}(window,c37.application.controller,window.THREE),function(e,t){function n(e){this.handlers=e||{},this.lastArgs={cmd:null},this.lastFeedrate=null,this.parseLine=function(e,t){var n=e;e.match(/^N/i)&&(e=e.replace(/^N\d+\s*/gi,"")),e=e.replace(/G00/i,"G0"),e=e.replace(/G0(\d)/i,"G$1"),e=e.replace(/([gmtxyzabcijkfst])/gi," $1"),e=e.replace(/([xyzabcijkfst])\s+/gi,"$1"),e=e.trim();var i=!1;if(e.match(/^(;|\(|<)/)?(e=n,i=!0):e=e.replace(/\(.*?\)/g,""),!e||i){var a={cmd:"empty or comment",text:e,origtext:n,indx:t,isComment:i},o=this.handlers.default;return o(a,t,this)}e=e.replace(/(;|\().*$/,"");var s=e.split(/\s+/);if(s){var r=s[0];r=r.toUpperCase(),i=!1,r.match(/^(G|M|T)/i)||(r=this.lastArgs.cmd,s.unshift(r));var a={cmd:r,text:e,origtext:n,indx:t,isComment:i,feedrate:null,plane:void 0};s.length>1&&!i&&s.splice(1).forEach(function(e){if(e&&e.length>0){var t=e[0].toLowerCase(),n=parseFloat(e.substring(1));a[t]=n}});var o=this.handlers[r]||this.handlers.default;if(a.isComment||(this.lastArgs=a),o){if(a.text.match(/\bG20\b/i)?l=!1:a.text.match(/\bG21\b/i)&&(l=!0),a.text.match(/F([\d.]+)/i)){var d=parseFloat(RegExp.$1);a.feedrate=d,this.lastFeedrate=d}else a.feedrate=this.lastFeedrate;return o(a,t,this)}console.error("No handler for gcode command!!!")}},this.parse=function(e){for(var t=e.split(/\r{0,1}\n/),n=0;n<t.length&&this.parseLine(t[n],n)!==!1;n++);}}function i(e,t){var i=[];i.G17=[],i.G18=[],i.G19=[];var o={x:0,y:0,z:0,e:0},s={x:0,y:0,z:0,e:0,f:0,feedrate:null,extruding:!1},r=new THREE.Group,d="G17",c=[],g=void 0,f=[],h=0,b=0,v={min:{x:1e5,y:1e5,z:1e5},max:{x:-1e5,y:-1e5,z:-1e5}},y={min:{x:1e5,y:1e5,z:1e5},max:{x:-1e5,y:-1e5,z:-1e5}},x=function(e){g={type:{},layer:c.length,z:e.z},c.push(g)},E=function(e,n){void 0==g&&x(e);var i=Math.round(e.e/1e3),a=(e.extruding?1e4:0)+i,o=new THREE.Color(e.extruding?16711935:u);return e.g0?(a="g0",o=new THREE.Color(m)):e.g2?(a="g2",o=new THREE.Color(p)):e.arc&&(a="arc",o=new THREE.Color(39423)),n.indx>t&&(a="ghost",o=new THREE.Color(0)),void 0==g.type[a]&&(g.type[a]={type:a,feed:e.e,extruding:e.extruding,color:o,segmentCount:0,material:new THREE.LineBasicMaterial({opacity:e.extruding?.3:e.g2?.2:.5,transparent:!0,linewidth:1,vertexColors:THREE.FaceColors}),geometry:new THREE.Geometry},n.indx>t&&(g.type[a].material.opacity=.05)),g.type[a]},w=function(e,t,n,a,o,s,r,d,c){var l=new THREE.ArcCurve(e,t,o,s,r,d),m=new THREE.LineBasicMaterial({color:43775,opacity:.5,transparent:!0}),u=new THREE.Geometry,p=0,g=n;l.getPoints(20).forEach(function(e){g=(a-n)/20*p+n,u.vertices.push(new THREE.Vector3(e.x,e.y,g)),p++});var f=new THREE.Line(u,m);return i[c].push(f),f},L=function(e,t,n,i){var a=n.x-e.x,o=n.y-e.y,s=n.z-e.z,r=n.x-t.x,d=n.y-t.y,c=n.z-t.z;switch(i.plane){case"G18":var l=Math.atan(s/a),m=Math.atan(c/r);break;case"G19":var l=Math.atan(s/o),m=Math.atan(c/d);break;default:var l=Math.atan(o/a),m=Math.atan(d/r)}var u=n.distanceTo(e),p=n.distanceTo(t);Number(u.toFixed(2))!=Number(p.toFixed(2));var g=!0;switch(i.clockwise===!1&&(g=!1),i.plane){case"G19":o>=0&&(l+=Math.PI),d>=0&&(m+=Math.PI);break;default:a>=0&&(l+=Math.PI),r>=0&&(m+=Math.PI)}if(l===m&&g===!1)switch(i.plane){case"G18":var f=w(n.x,n.z,-1*e.y,-1*t.y,u,l,m+2*Math.PI,g,"G18");break;case"G19":var f=w(n.y,n.z,e.x,t.x,u,l,m+2*Math.PI,g,"G19");break;default:var f=w(n.x,n.y,e.z,t.z,u,l,m+2*Math.PI,g,"G17")}else switch(i.plane){case"G18":var f=w(n.x,n.z,-1*e.y,-1*t.y,u,l,m,g,"G18");break;case"G19":var f=w(n.y,n.z,e.x,t.x,u,l,m,g,"G19");break;default:var f=w(n.x,n.y,e.z,t.z,u,l,m,g,"G17")}return f},I=function(e,t,n){f.push({p2:t,args:n});var i=E(t,n),a=i.geometry;if(i.segmentCount++,t.arc){var o,s=new THREE.Vector3(e.x,e.y,e.z),d=new THREE.Vector3(t.x,t.y,t.z);if(null!=n.r){radius=parseFloat(n.r);var c=Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2)+Math.pow(t.z-e.z,2)),l=(e.x+t.x)/2,m=(e.y+t.y)/2,u=(e.z+t.z)/2,p=void 0,g=void 0,x=Math.sqrt(radius*radius-Math.pow(c/2,2)),w=void 0;switch(n.plane){case"G18":if(p={x:l+x*(e.z-t.z)/c,y:m+x*(t.y-e.y)/c,z:u+x*(t.x-e.x)/c},g={x:l-x*(e.z-t.z)/c,y:m-x*(t.y-e.y)/c,z:u-x*(t.x-e.x)/c},w=Math.atan2(e.z,e.x)-Math.atan2(t.z,t.x),(e.x-p.x)*(e.z+p.z)+(p.x-t.x)*(p.z+t.z)>=(e.x-g.x)*(e.z+g.z)+(g.x-t.x)*(g.z+t.z))var I=p,z=g;else var I=g,z=p;break;case"G19":if(p={x:l+x*(e.x-t.x)/c,y:m+x*(e.z-t.z)/c,z:u+x*(t.y-e.y)/c},g={x:l-x*(e.x-t.x)/c,y:m-x*(e.z-t.z)/c,z:u-x*(t.y-e.y)/c},(e.y-p.y)*(e.z+p.z)+(p.y-t.y)*(p.z+t.z)>=(e.y-g.y)*(e.z+g.z)+(g.y-t.y)*(g.z+t.z))var I=p,z=g;else var I=g,z=p;break;default:if(p={x:l+x*(e.y-t.y)/c,y:m+x*(t.x-e.x)/c,z:u+x*(t.z-e.z)/c},g={x:l-x*(e.y-t.y)/c,y:m-x*(t.x-e.x)/c,z:u-x*(t.z-e.z)/c},(e.x-p.x)*(e.y+p.y)+(p.x-t.x)*(p.y+t.y)>=(e.x-g.x)*(e.y+g.y)+(g.x-t.x)*(g.y+t.y))var I=p,z=g;else var I=g,z=p}o=t.clockwise===!0&&radius>=0||t.clockwise===!1&&radius<0?new THREE.Vector3(I.x,I.y,I.z):new THREE.Vector3(z.x,z.y,z.z)}else{var B={x:t.arci?e.x+t.arci:e.x,y:t.arcj?e.y+t.arcj:e.y,z:t.arck?e.z+t.arck:e.z};o=new THREE.Vector3(B.x,B.y,B.z)}var G=L(s,d,o,n);t.g2=!0,t.threeObjArc=G,i=E(t,n)}else a.vertices.push(new THREE.Vector3(e.x,e.y,e.z)),a.vertices.push(new THREE.Vector3(t.x,t.y,t.z)),a.colors.push(i.color),a.colors.push(i.color);t.extruding&&(v.min.x=Math.min(v.min.x,t.x),v.min.y=Math.min(v.min.y,t.y),v.min.z=Math.min(v.min.z,t.z),v.max.x=Math.max(v.max.x,t.x),v.max.y=Math.max(v.max.y,t.y),v.max.z=Math.max(v.max.z,t.z)),t.g0,y.min.x=Math.min(y.min.x,t.x),y.min.y=Math.min(y.min.y,t.y),y.min.z=Math.min(y.min.z,t.z),y.max.x=Math.max(y.max.x,t.x),y.max.y=Math.max(y.max.y,t.y),y.max.z=Math.max(y.max.z,t.z);var k;if(t.arc)k=t.threeObjArc;else{var M=255;t.extruding?M=16711935:t.g0?M=65280:t.g2||t.arc&&(M=13311);var T=new THREE.LineBasicMaterial({color:M,opacity:.5,transparent:!0}),a=new THREE.Geometry;a.vertices.push(new THREE.Vector3(e.x,e.y,e.z),new THREE.Vector3(t.x,t.y,t.z));var S=new THREE.Line(a,T);k=S}k.userData.p2=t,k.userData.args=n,r.add(k);var O=0;if(t.arc){for(var C=t.threeObjArc.geometry,R=0,H=0;H<C.vertices.length-1;H++)R+=C.vertices[H].distanceTo(C.vertices[H+1]);var $=new THREE.Vector3(e.x,e.y,e.z),j=new THREE.Vector3(t.x,t.y,t.z);$.distanceTo(j);O=R}else{var $=new THREE.Vector3(e.x,e.y,e.z),j=new THREE.Vector3(t.x,t.y,t.z);O=$.distanceTo(j)}O>0&&(h+=O);var P=0;if(O>0){var F;F=n.feedrate>0?n.feedrate:100,P=O/F,P*=1.32}b+=P,t.feedrate=n.feedrate,t.dist=O,t.distSum=h,t.timeMins=P,t.timeMinsSum=b};h=0,b=0;var z=!1,B=function(e,t){return z?t:t-e},G=function(e,t){return z?e+t:t},k=function(e){var t={isFake:!0,text:e.text,indx:e.indx};t.text.match(/^(;|\(|<)/)&&(t.isComment=!0),f.push({p2:s,args:t})},M=new n({G0:function(e,t){var n={x:void 0!==e.x?G(s.x,e.x)+o.x:s.x,y:void 0!==e.y?G(s.y,e.y)+o.y:s.y,z:void 0!==e.z?G(s.z,e.z)+o.z:s.z,e:void 0!==e.e?G(s.e,e.e)+o.e:s.e,f:void 0!==e.f?G(s.f,e.f):s.f};n.g0=!0,I(s,n,e),s=n},G1:function(e,t){var n={x:void 0!==e.x?G(s.x,e.x)+o.x:s.x,y:void 0!==e.y?G(s.y,e.y)+o.y:s.y,z:void 0!==e.z?G(s.z,e.z)+o.z:s.z,e:void 0!==e.e?G(s.e,e.e)+o.e:s.e,f:void 0!==e.f?G(s.f,e.f):s.f};B(s.e,n.e)>0&&(n.extruding=B(s.e,n.e)>0,void 0!=g&&n.z==g.z||x(n)),I(s,n,e),s=n},G2:function(e,t,n){e.plane=d;var i={x:void 0!==e.x?G(s.x,e.x)+o.x:s.x,y:void 0!==e.y?G(s.y,e.y)+o.y:s.y,z:void 0!==e.z?G(s.z,e.z)+o.z:s.z,e:void 0!==e.e?G(s.e,e.e)+o.e:s.e,f:void 0!==e.f?G(s.f,e.f):s.f,arci:e.i?e.i:null,arcj:e.j?e.j:null,arck:e.k?e.k:null,arcr:e.r?e.r:null};i.arc=!0,i.clockwise=!0,e.clockwise===!1&&(i.clockwise=e.clockwise),I(s,i,e),s=i},G3:function(e,t,n){e.arc=!0,e.clockwise=!1,n.handlers.G2(e,t,n)},G17:function(e){d="G17",k(e)},G18:function(e){d="G18",k(e)},G19:function(e){d="G19",k(e)},G20:function(e){console.log("SETTING UNITS TO INCHES!!!"),l=!1,k(e)},G21:function(e){l=!0,k(e)},G73:function(e,t,n){console.log("G73 gcp:",n),n.handlers.G1(e)},G90:function(e){z=!1,k(e)},G91:function(e){z=!0,k(e)},G92:function(e){var t=s;o.x=void 0!==e.x?0===e.x?t.x:t.x-e.x:0,o.y=void 0!==e.y?0===e.y?t.y:t.y-e.y:0,o.z=void 0!==e.z?0===e.z?t.z:t.z-e.z:0,o.e=void 0!==e.e?0===e.e?t.e:t.e-e.e:0,k(e)},M30:function(e){k(e)},M82:function(e){k(e)},M84:function(e){k(e)},default:function(e,t){k(e)}});M.parse(e);var T=new THREE.Object3D;for(var S in c){var g=c[S];for(var O in g.type){var C=g.type[O],R=a(C.geometry,C.color);T.add(new THREE.Line(R,C.material,THREE.LinePieces))}}i.G17.forEach(function(e){var t=a(e.geometry,e.material.color);T.add(new THREE.Line(t,e.material))},this),i.G18.forEach(function(e){var t=a(e.geometry,e.material.color),n=new THREE.Line(t,e.material);n.rotateOnAxis(new THREE.Vector3(1,0,0),Math.PI/2),T.add(n)},this),i.G19.forEach(function(e){var t=a(e.geometry,e.material.color),n=new THREE.Line(t,e.material);n.rotateOnAxis(new THREE.Vector3(1,0,0),Math.PI/2),n.rotateOnAxis(new THREE.Vector3(0,1,0),Math.PI/2),T.add(n)},this);var H=(new THREE.Vector3(v.min.x+(v.max.x-v.min.x)/2,v.min.y+(v.max.y-v.min.y)/2,v.min.z+(v.max.z-v.min.z)/2),new THREE.Vector3(y.min.x+(y.max.x-y.min.x)/2,y.min.y+(y.max.y-y.min.y)/2,y.min.z+(y.max.z-y.min.z)/2));return T.userData.bbbox2=y,T.userData.lines=f,T.userData.layers=c,T.userData.center2=H,T.userData.extraObjects=i,T.userData.threeObjs=r,T}function a(e,t){for(var n=new Float32Array(3*e.vertices.length),i=new Float32Array(3*e.vertices.length),a=new THREE.BufferGeometry,o=0;o<e.vertices.length;o++){var s=e.vertices[o].x,r=e.vertices[o].y,d=e.vertices[o].z;n[3*o]=s,n[3*o+1]=r,n[3*o+2]=d,i[3*o]=t.r,i[3*o+1]=t.g,i[3*o+2]=t.b}return a.addAttribute("position",new THREE.BufferAttribute(n,3)),a.addAttribute("color",new THREE.BufferAttribute(i,3)),a.computeBoundingSphere(),a}function o(e,t,n){if(1===e.length){var a=e[0],o=a.name,l=o.lastIndexOf("."),m=o.substr(l+1).toLowerCase();if(d=o.substr(0,l),d=d.replace(/\ - (\d{4})-(\d{2})-(\d{2}) (\d{2})-(\d{2})-(\d{2})/,""),d=d.replace(/\ - (\d{4})-(\d{2})-(\d{2}) (\d{2}).(\d{2}).(\d{2})/,""),!(t.indexOf(m)>0))return n("Arquivo nÃ£o suportado");var u=new FileReader;c37.application.controller.reset(function(e){e&&(u.onload=function(e){switch(c=e.target.result,m){case"nc":if("ia32"!==s.arch&&"x32"!==s.arch){c37.application.controller.viewer.reset();var t=i(c);c37.application.controller.viewer.scene.add(t),c37.application.controller.viewer.objectsInScene.push(t),c37.application.controller.viewer.information(t),c37.application.controller.viewer.locate(t)}document.getElementById("strong-file-name").classList.remove("hide"),document.getElementById("strong-file-name").textContent=d,document.getElementById("list-gcode-content").innerHTML="";var a=c.split("\n");a=a.filter(function(e){return e.length>1}),a.forEach(function(e,t){var n=document.createElement("li"),i=document.createElement("div");i.style.fontSize="10px",i.id="gcode-content-"+t,i.textContent=e,n.appendChild(i),document.getElementById("list-gcode-content").appendChild(n)}),document.getElementById("progress-command-process").max=a.length,document.getElementById("progress-command-process").value=0,document.getElementById("number-planner").textContent="0",document.getElementById("span-command-length").textContent=a.length,document.getElementById("span-command-send").textContent=0,document.getElementById("span-file-time-worked").textContent="00:00:00",("ia32"===s.arch||"x32"===s.arch)&&a.length>7e3&&c37.library.message.operation.add({type:"warn",text:"",i18n:"[html]performance.gcode.text"}),r=!0}return n(!0)},u.readAsText(a))})}}t.object.namespace(e,"gcode");var s;e.gcode={initialize:function(e){s=e.computer},fileOpen:o,get fileIsOpen(){return r},get fileName(){return d},get fileData(){return c}};var r=!1,d="",c="",l=!0,m=65280,u=255,p=10066176}(c37.application.controller,c37.library.utility),function(e,t){var n=require("serialport"),i=null,a=null;t.object.namespace(e,"engine"),e.engine={list:function(){return new Promise(function(e,t){n.list(function(n,i){n?t(n):e(i.filter(function(e){return!e.comName.contains("ttyS")}))})})},connect:function(t,o,s){i=s;var r=new n(t,{autoOpen:!1,baudRate:o,parser:n.parsers.readline("\n")});if("Grbl"===i)a=e.firmware.grbl.controller.initialize(r);else if("C37"!==i)throw new Error("Not supported controller: "+i);return a.open()},disconnect:function(){return a.close()},command:function(e,t,n){return a.command(e,t,n)},get settings(){return a?a.settings:null},get state(){return a?a.state:null},get status(){return a?a.status:null},get workFlowState(){return a?a.workFlowState:null}}}(c37.application.controller,c37.library.utility),function(e,t,n,i){function a(){document.querySelectorAll(".program-version").forEach(function(e){e.textContent="v"+require("electron").remote.app.getVersion()}),window.onkeyup=function(e){32===e.keyCode&&(document.getElementById("button-milling-start").classList.contains("disabled")?setTimeout(function(){document.getElementById("button-milling-pause").click()},100):setTimeout(function(){document.getElementById("button-milling-start").click()},100))},window.onkeydown=function(e){39===e.keyCode&&document.getElementById("button-command-x-right").click(),37===e.keyCode&&document.getElementById("button-command-x-left").click(),40===e.keyCode&&document.getElementById("button-command-y-right").click(),38===e.keyCode&&document.getElementById("button-command-y-left").click(),33===e.keyCode&&document.getElementById("button-command-z-up").click(),34===e.keyCode&&document.getElementById("button-command-z-down").click()},document.getElementById("install-linux").addEventListener("click",function(){v.openExternal("https://www.google.com.br/webhp?sourceid=chrome-instant&ion=1&espv=2&ie=UTF-8#q=%22%2Fdev%2Fttyacm0%22+permission+denied")}),document.getElementById("install-windows").addEventListener("click",function(){v.openExternal("https://www.youtube.com/watch?v=N6aoacx8ruw")}),document.getElementById("install-macOS").addEventListener("click",function(){v.openExternal("https://www.youtube.com/watch?v=N6aoacx8ruw")}),document.getElementById("goto-c37").addEventListener("click",function(){v.openExternal("http://c37.co")}),document.getElementById("goto-c37-firmware").addEventListener("click",function(){v.openExternal("https://c37.co/software/firmware.html")}),document.getElementById("goto-grbl").addEventListener("click",function(){v.openExternal("https://github.com/grbl/grbl")}),document.getElementById("goto-group").addEventListener("click",function(){v.openExternal("https://www.facebook.com/groups/c37.controller/")}),document.getElementById("goto-donation").addEventListener("click",function(){v.openExternal("http://mpago.la/SeiL")}),document.getElementById("option-group-i18n").addEventListener("selected",function(e){var t=e.detail.value;i18n.setLng(t,f,function(e,n){i18n.translateObject(document),document.getElementsByTagName("html")[0].setAttribute("lang",i18n.lng());var a={uuid:"i18n",value:t};i.operation.add("settings",a.uuid,a,function(e){if(e)throw new Error("Tool - Initialize - Failed to Initialize Tool from Local Database \n http://cam.c37.co/docs/errors.html#tool-initialize")})})});var t=document.getElementById("input-file-manager");t.addEventListener("change",function(){e.gcode.fileOpen(this.files,this.accept,function(e){if(e)return s("isOpenFile"),!0}),this.value=""}),document.getElementById("button-gcode-open").onclick=function(){this.classList.contains("disabled")||(t.accept=".nc",t.click())},document.getElementById("text-command-send").onkeydown=function(t){if(13===t.keyCode&&this.value){var n=this.value;n.toLowerCase().indexOf("m")>0||n.toLowerCase().indexOf("$")>-1?e.engine.command("gcode",n):e.engine.command("gcode","G91"+n),this.value=""}},document.getElementById("button-command-reset").onclick=function(){this.classList.contains("disabled")||e.engine.command("gcode","")},document.getElementById("button-position-zero-define").onclick=function(){this.classList.contains("disabled")||e.engine.command("gcode","G10 P0 L20 X0 Y0 Z0")},document.getElementById("button-position-zero-return").onclick=function(){this.classList.contains("disabled")||e.engine.command("gcode","G90 G0 Z5 \n G90 G0 X0 Y0 \n G90 G0 Z0 \n")},document.getElementById("button-command-x-left").onclick=function(){if(!this.classList.contains("disabled")){var t=document.getElementById("button-command-displace").dataset.selected;e.engine.command("gcode",n.string.format("G91 G0 X-{0}",[1*t]))}},document.getElementById("button-command-x-right").onclick=function(){if(!this.classList.contains("disabled")){var t=document.getElementById("button-command-displace").dataset.selected;e.engine.command("gcode",n.string.format("G91 G0 X{0}",[1*t]))}},document.getElementById("button-command-y-left").onclick=function(){if(!this.classList.contains("disabled")){var t=document.getElementById("button-command-displace").dataset.selected;e.engine.command("gcode",n.string.format("G91 G0 Y{0}",[1*t]))}},document.getElementById("button-command-y-right").onclick=function(){if(!this.classList.contains("disabled")){var t=document.getElementById("button-command-displace").dataset.selected;e.engine.command("gcode",n.string.format("G91 G0 Y-{0}",[1*t]))}},document.getElementById("button-command-z-up").onclick=function(){if(!this.classList.contains("disabled")){var t=document.getElementById("button-command-displace").dataset.selected;e.engine.command("gcode",n.string.format("G91 G0 Z{0}",[1*t]))}},document.getElementById("button-command-z-down").onclick=function(){if(!this.classList.contains("disabled")){var t=document.getElementById("button-command-displace").dataset.selected;e.engine.command("gcode",n.string.format("G91 G0 Z-{0}",[1*t]))}},document.getElementById("checkbox-toggle-spindle").onclick=function(){e.engine.command("gcode",this.checked?"M3":"M5")},document.getElementById("checkbox-toggle-coolant").onclick=function(){e.engine.command("gcode",this.checked?"M7":"M9")},document.getElementById("button-probe-start").onclick=function(){this.classList.contains("disabled")||e.probe.mapping.start()},document.getElementById("button-probe-collect").onclick=function(){this.classList.contains("disabled")||e.probe.mapping.collect(this.querySelector("span"))},document.getElementById("button-probe-stop").onclick=function(){this.classList.contains("disabled")||e.probe.mapping.stop()},document.getElementById("button-probe-remove").onclick=function(){this.classList.contains("disabled")||e.probe.mapping.remove()},document.getElementById("button-milling-start").onclick=function(){this.classList.contains("disabled")||(e.engine.state===e.engine.workFlowState.IDLE?e.engine.command("load",{name:e.gcode.fileName,gcode:e.gcode.fileData},function(t){t&&e.engine.command("start",null,function(e){s("isStartProcess")})}):e.engine.state===e.engine.workFlowState.HOLD&&e.engine.command("resume",null,function(e){e&&setTimeout(function(){s("isStartProcess")},200)}))},document.getElementById("button-milling-pause").onclick=function(){this.classList.contains("disabled")||e.engine.command("pause",null,function(e){e&&s("isPauseProcess")})},document.getElementById("button-milling-stop").onclick=function(){this.classList.contains("disabled")||e.engine.command("stop",null,function(e){e&&setTimeout(function(){s("isStopProcess")},200)})},document.getElementById("input-milling-feed-rate").oninput=function(){document.getElementById("label-milling-feed-rate").textContent=this.value},document.getElementById("button-viewer-home").onclick=function(){e.viewer.locate()},document.getElementById("button-viewer-zoom-more").onclick=function(){e.viewer.zoom.more()},document.getElementById("button-viewer-zoom-less").onclick=function(){e.viewer.zoom.less()}}function o(i){var a=e.engine.status;document.getElementById("checkbox-toggle-spindle").checked=a.spindle,document.getElementById("checkbox-toggle-coolant").checked=a.coolant,a.received<=20&&(document.getElementById("list-gcode-content").scrollTop=0,n.interface.unfade(document.getElementById("box-milling"))),(a.received<=0||a.startedTime<=0)&&(document.getElementById("progress-command-process").max=0,document.getElementById("progress-command-process").value=0,document.getElementById("number-planner").textContent="0",document.getElementById("span-command-length").textContent=0,document.getElementById("span-command-send").textContent=0,document.getElementById("span-file-time-worked").textContent="00:00:00"),h.interval.length>=2||(h.interval.push(setInterval(function(){a=e.engine.status,document.getElementById("progress-command-process").max=a.total,document.getElementById("progress-command-process").value=a.received,document.getElementById("span-command-length").textContent=a.total||document.getElementById("span-command-length").textContent,document.getElementById("span-command-send").textContent=a.received||document.getElementById("span-command-send").textContent,document.getElementById("progress-planner").max=a.bufferSize,document.getElementById("progress-planner").value=a.queueSize,document.getElementById("number-planner").textContent=a.queueSize,document.getElementById("span-milling-feed-rate").textContent=a.feedRate+"mm/m";var t=document.getElementById("gcode-content-"+a.received);t&&t.parentNode&&t.parentNode.offsetTop>100&&a.received>0&&(document.getElementById("list-gcode-content").scrollTop=t.parentNode.offsetTop)},100)),h.interval.push(setInterval(function(){h.duration++,document.getElementById("span-file-time-worked").textContent=t().subtract(t().subtract(h.duration,"seconds")).format("HH:mm:ss")},1e3)))}function s(t){b=t;var n=document.getElementById("button-disconnected"),i=document.getElementById("button-connected"),a=(document.getElementById("i-connection-status"),document.getElementById("button-settings-open")),s=document.getElementById("button-gcode-open"),r=document.getElementById("text-command-send"),d=document.getElementById("button-command-reset"),c=(document.getElementById("button-axis-home"),
document.getElementById("button-position-zero-define")),l=document.getElementById("button-position-zero-return"),m=document.getElementById("icon-probe-settings"),u=document.getElementById("button-probe-mode-explore"),p=document.getElementById("button-probe-mode-level"),g=document.getElementById("button-probe-start"),f=document.getElementById("button-probe-collect"),v=document.getElementById("button-probe-stop"),y=document.getElementById("button-probe-remove"),x=document.getElementById("button-milling-start"),E=document.getElementById("button-milling-pause"),w=document.getElementById("button-milling-stop"),L=document.getElementById("button-command-displace-3"),I=document.getElementById("button-command-displace-2"),z=document.getElementById("button-command-displace-1"),B=document.getElementById("button-command-displace-01"),G=document.getElementById("button-command-displace-001"),k=document.getElementById("button-command-x-left"),M=document.getElementById("button-command-x-right"),T=document.getElementById("button-command-y-left"),S=document.getElementById("button-command-y-right"),O=document.getElementById("button-command-z-up"),C=document.getElementById("button-command-z-down"),R=document.getElementById("button-toggle-spindle"),H=document.getElementById("checkbox-toggle-spindle"),$=document.getElementById("button-toggle-coolant"),j=document.getElementById("checkbox-toggle-coolant");return"isDisconnected"===t&&(h.disconnected(),n.classList.remove("hide"),i.classList.add("hide"),a.classList.add("disabled"),r.classList.add("disabled"),r.disabled=!0,d.classList.add("disabled"),c.classList.add("disabled"),l.classList.add("disabled"),m.classList.add("disabled"),u.classList.add("disabled"),p.classList.add("disabled"),g.classList.add("disabled"),f.classList.add("disabled"),v.classList.add("disabled"),y.classList.add("disabled"),document.getElementById("progress-planner").value=0,x.classList.add("disabled"),E.classList.add("disabled"),w.classList.add("disabled"),L.classList.add("disabled"),I.classList.add("disabled"),z.classList.add("disabled"),B.classList.add("disabled"),G.classList.add("disabled"),k.classList.add("disabled"),M.classList.add("disabled"),T.classList.add("disabled"),S.classList.add("disabled"),O.classList.add("disabled"),C.classList.add("disabled"),R.classList.remove("enable"),R.classList.add("disabled"),H.disabled=!0,H.checked=!1,$.classList.remove("enable"),$.classList.add("disabled"),j.disabled=!0,j.checked=!1),"isConnected"===t&&(n.classList.add("hide"),i.classList.remove("hide"),a.classList.remove("disabled"),r.classList.remove("disabled"),r.disabled=!1,c.classList.remove("disabled"),l.classList.remove("disabled"),L.classList.remove("disabled"),I.classList.remove("disabled"),z.classList.remove("disabled"),B.classList.remove("disabled"),G.classList.remove("disabled"),k.classList.remove("disabled"),M.classList.remove("disabled"),T.classList.remove("disabled"),S.classList.remove("disabled"),O.classList.remove("disabled"),C.classList.remove("disabled"),R.classList.add("enable"),R.classList.remove("disabled"),H.disabled=!1,$.classList.add("enable"),$.classList.remove("disabled"),j.disabled=!1,m.classList.remove("disabled"),u.classList.remove("disabled"),p.classList.remove("disabled"),g.classList.remove("disabled"),f.classList.add("disabled"),v.classList.add("disabled"),e.gcode.fileIsOpen?x.classList.remove("disabled"):x.classList.add("disabled"),E.classList.add("disabled"),w.classList.add("disabled")),"isOpenFile"===t&&(i.classList.contains("hide")||x.classList.remove("disabled"),E.classList.add("disabled"),w.classList.add("disabled")),"isStartProcess"===t&&(o(t),a.classList.add("disabled"),s.classList.add("disabled"),r.classList.add("disabled"),r.disabled=!0,d.classList.add("disabled"),c.classList.add("disabled"),l.classList.add("disabled"),x.classList.add("disabled"),E.classList.remove("disabled"),w.classList.remove("disabled"),L.classList.add("disabled"),I.classList.add("disabled"),z.classList.add("disabled"),B.classList.add("disabled"),G.classList.add("disabled"),k.classList.add("disabled"),M.classList.add("disabled"),T.classList.add("disabled"),S.classList.add("disabled"),O.classList.add("disabled"),C.classList.add("disabled"),R.classList.remove("enable"),R.classList.add("disabled"),H.disabled=!0,$.classList.remove("enable"),$.classList.add("disabled"),j.disabled=!0),"isPauseProcess"===t&&(h.pause(),r.classList.add("disabled"),r.disabled=!0,c.classList.add("disabled"),l.classList.add("disabled"),x.classList.remove("disabled"),E.classList.add("disabled"),w.classList.remove("disabled"),L.classList.add("disabled"),I.classList.add("disabled"),z.classList.add("disabled"),B.classList.add("disabled"),G.classList.add("disabled"),k.classList.add("disabled"),M.classList.add("disabled"),T.classList.add("disabled"),S.classList.add("disabled"),O.classList.add("disabled"),C.classList.add("disabled")),"isStopProcess"!==t&&"isEndProcess"!==t||(h.stop(),a.classList.remove("disabled"),s.classList.remove("disabled"),r.classList.remove("disabled"),r.disabled=!1,d.classList.remove("disabled"),c.classList.remove("disabled"),l.classList.remove("disabled"),document.getElementById("progress-planner").value=0,e.gcode.fileIsOpen?x.classList.remove("disabled"):x.classList.add("disabled"),E.classList.add("disabled"),w.classList.add("disabled"),L.classList.remove("disabled"),I.classList.remove("disabled"),z.classList.remove("disabled"),B.classList.remove("disabled"),G.classList.remove("disabled"),k.classList.remove("disabled"),M.classList.remove("disabled"),T.classList.remove("disabled"),S.classList.remove("disabled"),O.classList.remove("disabled"),C.classList.remove("disabled"),R.classList.add("enable"),R.classList.remove("disabled"),H.disabled=!1,$.classList.add("enable"),$.classList.remove("disabled"),j.disabled=!1),"isStartProbe"===t&&(a.classList.add("disabled"),s.classList.add("disabled"),r.classList.add("disabled"),r.disabled=!0,d.classList.add("disabled"),c.classList.add("disabled"),l.classList.add("disabled"),m.classList.add("disabled"),u.classList.add("disabled"),p.classList.add("disabled"),g.classList.add("disabled"),f.classList.add("disabled"),v.classList.add("disabled"),v.querySelector("span").textContent="Parar",y.classList.add("disabled"),x.classList.add("disabled"),E.classList.add("disabled"),w.classList.add("disabled"),L.classList.add("disabled"),I.classList.add("disabled"),z.classList.add("disabled"),B.classList.add("disabled"),G.classList.add("disabled"),k.classList.add("disabled"),M.classList.add("disabled"),T.classList.add("disabled"),S.classList.add("disabled"),O.classList.add("disabled"),C.classList.add("disabled")),"isStopProbe"===t&&(a.classList.remove("disabled"),s.classList.remove("disabled"),r.classList.remove("disabled"),r.disabled=!1,d.classList.remove("disabled"),c.classList.remove("disabled"),l.classList.remove("disabled"),x.classList.remove("disabled"),E.classList.add("disabled"),w.classList.add("disabled"),L.classList.remove("disabled"),I.classList.remove("disabled"),z.classList.remove("disabled"),B.classList.remove("disabled"),G.classList.remove("disabled"),k.classList.remove("disabled"),M.classList.remove("disabled"),T.classList.remove("disabled"),S.classList.remove("disabled"),O.classList.remove("disabled"),C.classList.remove("disabled")),"isEndProbe"===t&&(x.classList.remove("disabled"),E.classList.add("disabled"),w.classList.add("disabled")),!0}function r(e){return document.getElementById("strong-axis-position-x").textContent=e.x,document.getElementById("strong-axis-position-y").textContent=e.y,document.getElementById("strong-axis-position-z").textContent=e.z,!0}function d(e,t){}function c(e,t){var i=document.getElementById("box-milling"),a=document.getElementById("span-milling-tool"),o=document.getElementById("icon-milling-type"),s=document.getElementById("span-milling-feed-rate");if("isUpdate"===e){t=t.replace("(","").replace(")","");var r=t.split("|");3===r.length&&(i.classList.remove("hide"),a.textContent=r[0],s.textContent=n.string.format("{0} mm/sec",[r[2]]),(r[1].toLowerCase().contains("cut")||r[1].toLowerCase().contains("cortar"))&&(o.className="icon-milling-cut"),(r[1].toLowerCase().contains("drill")||r[1].toLowerCase().contains("furar"))&&(o.className="icon-milling-drill"),(r[1].toLowerCase().contains("deepen")||r[1].toLowerCase().contains("aprofundar"))&&(o.className="icon-milling-deepen"),(r[1].toLowerCase().contains("engrave")||r[1].toLowerCase().contains("gravar"))&&(o.className="icon-milling-engrave"))}"isClosed"!==e&&"isEnd"!==e||i.classList.add("hide")}function l(){function t(t){var a=document.getElementById("list-devices").querySelectorAll("li");[].forEach.call(a,function(e){e.classList.contains("device-empty")||e.parentNode.removeChild(e)}),e.engine.list().then(function(e){return e.length>0?(document.getElementById("list-devices").querySelector("li:first-child").classList.add("hide"),e.forEach(function(e){document.getElementById("list-devices").appendChild(n(e,function(e){e&&i.close()}))})):document.getElementById("list-devices").querySelector("li:first-child").classList.remove("hide"),!t||t(!0)})}function n(t,n){var i=document.createElement("li"),a=document.createElement("div"),o=document.createElement("i"),s=document.createElement("strong");return o.classList.add("icon-device"),o.style.verticalAlign="middle",s.style.position="relative",s.style.marginLeft="5px",s.style.top="2px",s.textContent=t.comName,a.appendChild(o),a.appendChild(s),i.dataset.devicePath=t.comName,i.classList.add("text-center"),i.appendChild(a),i.onclick=function(){e.engine.connect(this.dataset.devicePath,115200,"Grbl").then(function(e){return n(e)})},i}var i=document.getElementById("dialog-devices");document.getElementById("button-disconnected").onclick=function(){t(function(e){if(e)return i.showModal()})},document.getElementById("button-connected").onclick=function(){e.engine.disconnect()},document.getElementById("button-devices-close").onclick=function(e){i.close()}}function m(){var t=document.getElementById("dialog-settings");document.getElementById("button-settings-close").onclick=function(){t.close()},document.getElementById("button-settings-open").onclick=function(){this.classList.contains("disabled")||(e.engine.command("gcode","$$"),setTimeout(function(){var i=e.engine.settings,a=document.getElementById("text-setting-step-x"),o=document.getElementById("text-setting-step-y"),s=document.getElementById("text-setting-step-z"),r=document.getElementById("text-setting-feed-rate-x"),d=document.getElementById("text-setting-feed-rate-y"),c=document.getElementById("text-setting-feed-rate-z"),l=document.getElementById("text-setting-accel-x"),m=document.getElementById("text-setting-accel-y"),u=document.getElementById("text-setting-accel-z");a.value=i.$100,o.value=i.$101,s.value=i.$102,l.value=n.math.parseFloat(i.$120),m.value=n.math.parseFloat(i.$121),u.value=n.math.parseFloat(i.$122),r.value=n.math.parseFloat(i.$110),d.value=n.math.parseFloat(i.$111),c.value=n.math.parseFloat(i.$112),t.showModal()},300))},document.getElementById("button-settings-save").onclick=function(i){var a=e.engine.settings,o=document.getElementById("text-setting-step-x"),s=document.getElementById("text-setting-step-y"),r=document.getElementById("text-setting-step-z"),d=document.getElementById("text-setting-feed-rate-x"),c=document.getElementById("text-setting-feed-rate-y"),l=document.getElementById("text-setting-feed-rate-z"),m=document.getElementById("text-setting-accel-x"),u=document.getElementById("text-setting-accel-y"),p=document.getElementById("text-setting-accel-z");document.getElementById("text-setting-correction-x"),document.getElementById("text-setting-correction-y"),document.getElementById("text-setting-correction-z");""!==o.value&&""!==s.value&&""!==r.value&&""!==m.value&&""!==u.value&&""!==p.value&&""!==d.value&&""!==c.value&&""!==l.value&&/^[0-9]+([\.][0-9]+)?$/.test(o.value)&&/^[0-9]+([\.][0-9]+)?$/.test(s.value)&&/^[0-9]+([\.][0-9]+)?$/.test(r.value)&&/^[0-9]+([\.][0-9]+)?$/.test(m.value)&&/^[0-9]+([\.][0-9]+)?$/.test(u.value)&&/^[0-9]+([\.][0-9]+)?$/.test(p.value)&&/^[0-9]+([\.][0-9]+)?$/.test(d.value)&&/^[0-9]+([\.][0-9]+)?$/.test(d.value)&&/^[0-9]+([\.][0-9]+)?$/.test(d.value)&&(setTimeout(function(){setTimeout(function(){n.math.parseFloat(a.$100,3)!==n.math.parseFloat(o.value,3)&&e.engine.command("gcode","$100="+o.value+"\n")},50),setTimeout(function(){n.math.parseFloat(a.$101,3)!==n.math.parseFloat(s.value,3)&&e.engine.command("gcode","$101="+s.value+"\n")},100),setTimeout(function(){n.math.parseFloat(a.$102,3)!==n.math.parseFloat(r.value,3)&&e.engine.command("gcode","$102="+r.value+"\n")},150)},10),setTimeout(function(){setTimeout(function(){n.math.parseFloat(a.$110,3)!==n.math.parseFloat(d.value,3)&&e.engine.command("gcode","$110="+d.value+"\n")},50),setTimeout(function(){n.math.parseFloat(a.$111,3)!==n.math.parseFloat(c.value,3)&&e.engine.command("gcode","$111="+c.value+"\n")},100),setTimeout(function(){n.math.parseFloat(a.$112,3)!==n.math.parseFloat(l.value,3)&&e.engine.command("gcode","$112="+l.value+"\n")},150)},150),setTimeout(function(){setTimeout(function(){n.math.parseFloat(a.$120,3)!==n.math.parseFloat(m.value,3)&&e.engine.command("gcode","$120="+m.value+"\n")},50),setTimeout(function(){n.math.parseFloat(a.$121,3)!==n.math.parseFloat(u.value,3)&&e.engine.command("gcode","$121="+u.value+"\n")},100),setTimeout(function(){n.math.parseFloat(a.$122,3)!==n.math.parseFloat(p.value,3)&&e.engine.command("gcode","$122="+p.value+"\n")},150),t.close()},300))},t.addEventListener("close",function(){})}function u(){var e=document.getElementById("dialog-help");document.getElementById("button-help-close").onclick=function(){e.close()},document.getElementById("button-help-open").onclick=function(){e.showModal()}}function p(){var e=document.getElementById("dialog-probe");document.getElementById("button-probe-settings-close").onclick=function(){e.close()},document.getElementById("button-probe-settings-save").onclick=function(){e.close()},document.getElementById("icon-probe-settings").onclick=function(){this.classList.contains("disabled")||e.showModal()}}function g(){var e=document.getElementById("dialog-donation");document.getElementById("button-donation-close").onclick=function(){e.close()},document.getElementById("button-donation-open").onclick=function(){e.showModal()}}var f=null,h={duration:1,interval:[],disconnected:function(){document.getElementById("checkbox-toggle-spindle").checked=!1,document.getElementById("checkbox-toggle-coolant").checked=!1,h.interval.forEach(function(e){clearInterval(e)}),h.duration=1,h.interval=[]},stop:function(){document.getElementById("checkbox-toggle-spindle").checked=!1,document.getElementById("checkbox-toggle-coolant").checked=!1,n.interface.fade(document.getElementById("box-milling")),setTimeout(function(){h.interval.forEach(function(e){clearInterval(e)}),h.duration=1,h.interval=[]},200)},pause:function(){h.interval.forEach(function(e){clearInterval(e)}),h.interval=[]}},b=null,v=require("electron").shell;e.interface={initialize:function(e){return f=e.i18n,a(),s("isDisconnected"),l(),m(),u(),m(),p(),g(),setTimeout(function(){document.getElementById("dialog-donation").showModal()},350),!0},reset:function(){},tool:d,status:s,milling:c,position:r,update:function(e){return!0},get state(){return b}}}(c37.application.controller,c37.library.moment,c37.library.utility,c37.library.database),function(e,t){var n={sensor:{height:0,speed:0},displacement:{x:0,y:0,z:0},level:{gridX:0,gridY:0}},i={isComplete:!1,grid:[]};t.object.namespace(e,"probe"),e.probe={initialize:function(e){},get settings(){return n},set settings(e){},mapping:{get isComplete(){return i.isComplete},start:function(){e.interface.status("isStartProbe"),console.log(this)},collect:function(e){i.isComplete=!0},stop:function(){},remove:function(){}},parse:function(e){return[]}}}(c37.application.controller,c37.library.utility),function(e,t){var n={name:"",gcode:"",remain:[],received:0,total:0,streaming:{bufferSize:120,queue:[]},createdTime:0,startedTime:0,finishedTime:0,feedRate:0,spindle:!1,coolant:!1};t.object.namespace(e,"firmware.grbl.sender"),e.firmware.grbl.sender={load:function(e,t){return n.name=e,n.gcode=t,n.remain=t.split("\n").filter(function(e){return e.replace(/ /g,"").length>1}),n.received=0,n.total=n.remain.length,n.streaming.queue=[],n.createdTime=(new Date).getTime(),n.startedTime=0,n.finishedTime=0,n.spindle=t.indexOf("M3")>0||t.indexOf("M4")>0||t.indexOf("m3")>0||t.indexOf("m4")>0,n.coolant=t.indexOf("M7")>0||t.indexOf("M8")>0||t.indexOf("m7")>0||t.indexOf("m8")>0,!0},unload:function(){n.name="",n.gcode="",n.remain=[],n.received=0,n.total=0,n.streaming.queue=[],n.createdTime=0,n.startedTime=0,n.finishedTime=0},get status(){return{startedTime:n.startedTime,finishedTime:n.finishedTime,total:n.total,received:n.received,queueSize:n.streaming.queue.join("").length,bufferSize:n.streaming.bufferSize,coolant:n.coolant,spindle:n.spindle,feedRate:n.feedRate}},get state(){return n},next:function(e){if(0!==n.remain.length||0!==n.received){for(n.remain.length>0&&0===n.received&&(n.startedTime=(new Date).getTime());n.remain.length>0;){var t=i(n.remain[0]).trim(),a=n.streaming.queue.join("").length;if(t.length>1){if(t.length+a>n.streaming.bufferSize)break;a<=n.streaming.bufferSize/2&&n.received>10&&c37.library.message.operation.add({type:"warn",text:"",i18n:"Teste - Analizador de Performance!"}),e.write(t+"\n");var o=t.match(/F([\d.]+)/i);o&&(n.feedRate=o[1]),n.streaming.queue.push(n.remain.shift().trim()),this.ack()}else n.remain.shift(),this.ack()}0===n.remain.length&&n.received===n.total&&(n.finishedTime=(new Date).getTime())}},responseNext:function(e){n.streaming.queue.shift(),this.next(e)},rewind:function(){n.remain=[],n.streaming.queue=[],n.received=0,n.startedTime=0,n.finishedTime=0},ack:function(){n.received++}};var i=function(){var e=new RegExp(/\s*[%#;].*/g),t=new RegExp(/\s*\([^\)]*\)/g);return function(n){return n.replace(e,"").replace(t,"").replace(/ /g,"")}}()}(c37.application.controller,c37.library.utility),function(i,a){var o=[{group:"motion",modes:["G0","G1","G2","G3","G38.2","G38.3","G38.4","G38.5","G80"]},{group:"coordinate",modes:["G54","G55","G56","G57","G58","G59"]},{group:"plane",modes:["G17","G18","G19"]},{group:"units",modes:["G20","G21"]},{group:"distance",modes:["G90","G91"]},{group:"feedrate",modes:["G93","G94"]},{group:"program",modes:["M0","M1","M2","M30"]},{group:"spindle",modes:["M3","M4","M5"]},{group:"coolant",modes:["M7","M8","M9"]}];a.object.namespace(i,"firmware.grbl.message"),i.firmware.grbl.message={parse:function(e){var t=!0,n=!1,i=void 0;try{for(var a,o=x[Symbol.iterator]();!(t=(a=o.next()).done);t=!0){var s=a.value,r=s.parse(e);if(r)return _.set(r,"payload.raw",e),r}}catch(e){n=!0,i=e}finally{try{!t&&o.return&&o.return()}finally{if(n)throw i}}return{type:null,payload:{raw:e}}}};var s=function(){function t(){e(this,t)}return n(t,null,[{key:"parse",value:function(e){var t=e.match(/^<(.+)>/);if(!t)return null;var n={},i=/[a-zA-Z]+(:[0-9\.\-]+(,[0-9\.\-]+){0,5})?/g,a=t[1].match(i),o={},s=(a.shift()||"").split(":");n.activeState=s[0]||"",n.subState=Number(s[1]||"");var r=!0,d=!1,c=void 0;try{for(var l,m=a[Symbol.iterator]();!(r=(l=m.next()).done);r=!0){var u=l.value,p=u.match(/^(.+):(.+)/);if(p){var g=p[1],f=p[2].split(",");o[g]=f}}}catch(e){d=!0,c=e}finally{try{!r&&m.return&&m.return()}finally{if(d)throw c}}if(_.has(o,"MPos")){var h=["x","y","z","a","b","c"],b=_.get(o,"MPos",["0.000","0.000","0.000"]);n.mpos={};for(var v=0;v<b.length;++v)n.mpos[h[v]]=b[v]}if(_.has(o,"WPos")){var y=["x","y","z","a","b","c"],x=_.get(o,"WPos",["0.000","0.000","0.000"]);n.wpos={};for(var E=0;E<x.length;++E)n.wpos[y[E]]=x[E]}if(_.has(o,"WCO")){var w=["x","y","z","a","b","c"],L=_.get(o,"WCO",["0.000","0.000","0.000"]);n.wco={};for(var I=0;I<L.length;++I)n.wco[w[I]]=L[I]}if(_.has(o,"Buf")&&(n.buf=n.buf||{},n.buf.planner=Number(_.get(o,"Buf[0]",0))),_.has(o,"RX")&&(n.buf=n.buf||{},n.buf.rx=Number(_.get(o,"RX[0]",0))),_.has(o,"Bf")&&(n.buf=n.buf||{},n.buf.planner=Number(_.get(o,"Bf[0]",0)),n.buf.rx=Number(_.get(o,"Bf[1]",0))),_.has(o,"Ln")&&(n.ln=Number(_.get(o,"Ln[0]",0))),_.has(o,"F")&&(n.feedrate=Number(_.get(o,"F[0]",0))),_.has(o,"FS")&&(n.feedrate=Number(_.get(o,"FS[0]",0)),n.spindle=Number(_.get(o,"FS[1]",0))),_.has(o,"Lim")){var z=Number(_.get(o,"Lim[0]",0));n.pinState=[1&z?"X":"",2&z?"Y":"",4&z?"Z":"",4&z?"A":""].join("")}return _.has(o,"Pn")&&(n.pinState=_.get(o,"Pn[0]","")),_.has(o,"Ov")&&(n.ov=_.get(o,"Ov",[]).map(function(e){return Number(e)})),_.has(o,"A")&&(n.accessoryState=_.get(o,"A[0]","")),{type:"Status",payload:n}}}]),t}(),r=function(){function t(){e(this,t)}return n(t,null,[{key:"parse",value:function(e){var t=e.match(/^ok/);if(!t)return null;var n={};return{type:"Ok",payload:n}}}]),t}(),d=function(){function t(){e(this,t)}return n(t,null,[{key:"parse",value:function(e){var t=e.match(/^error:\s*(.+)/);if(!t)return null;var n={message:t[1]};return{type:"Error",payload:n}}}]),t}(),c=function(){function t(){e(this,t)}return n(t,null,[{key:"parse",value:function(e){var t=e.match(/^ALARM:\s*(.+)$/);if(!t)return null;var n={message:t[1]};return{type:"Alarm",payload:n}}}]),t}(),l=function(){function t(){e(this,t)}return n(t,null,[{key:"parse",value:function(e){var t=e.match(/^\[(?:GC:)?((?:[a-zA-Z][0-9]+(?:\.[0-9]*)?\s*)+)\]/);if(!t)return null;var n={},i=_(t[1].split(" ")).compact().map(function(e){return _.trim(e)}).value();return i.forEach(function(e){if(0===e.indexOf("G")||0===e.indexOf("M")){var t=_.find(o,function(t){return _.includes(t.modes,e)});t&&_.set(n,"modal."+t.group,e)}0===e.indexOf("T")&&_.set(n,"tool",e.substring(1)),0===e.indexOf("F")&&_.set(n,"feedrate",e.substring(1)),0===e.indexOf("S")&&_.set(n,"spindle",e.substring(1))}),{type:"State",payload:n}}}]),t}(),m=function(){function i(){e(this,i)}return n(i,null,[{key:"parse",value:function(e){var n=e.match(/^\[(G54|G55|G56|G57|G58|G59|G28|G30|G92|TLO|PRB):(.+)\]$/);if(!n)return null;var i,a,o=n[1],s=n[2],r={name:o,value:""},d=/^G\d+$/i;if(d.test(o)){i=["x","y","z","a","b","c"],a=s.split(","),r.value={};for(var c=0;c<a.length;++c)r.value[i[c]]=a[c]}if("TLO"===o&&(r.value=s),"PRB"===o){i=["x","y","z","a","b","c"];var l=s.split(":"),m=t(l,2),u=m[0],p=m[1];a=u.split(","),r.value={},r.value.result=Number(p);for(var g=0;g<a.length;++g)r.value[i[g]]=a[g]}return{type:"Parameters",payload:r}}}]),i}(),u=function(){function t(){e(this,t)}return n(t,null,[{key:"parse",value:function(e){var t=e.match(/^\[(?:HLP:)?(.+)\]$/);if(!t)return null;var n={message:t[1]};return{type:"Help",payload:n}}}]),t}(),p=function(){function t(){e(this,t)}return n(t,null,[{key:"parse",value:function(e){var t=e.match(/^\[(?:VER:)?(.+)\]$/);if(!t)return null;var n={message:t[1]};return{type:"Version",payload:n}}}]),t}(),g=function(){function t(){e(this,t)}return n(t,null,[{key:"parse",value:function(e){var t=e.match(/^\[(?:OPT:)?(.+)\]$/);if(!t)return null;var n={message:t[1]};return{type:"Option",payload:n}}}]),t}(),f=function(){function t(){e(this,t)}return n(t,null,[{key:"parse",value:function(e){var t=e.match(/^\[(?:echo:)?(.+)\]$/);if(!t)return null;var n={message:t[1]};return{type:"Echo",payload:n}}}]),t}(),h=function(){function t(){e(this,t)}return n(t,null,[{key:"parse",value:function(e){var t=e.match(/^\[(?:MSG:)?(.+)\]$/);if(!t)return null;var n={message:t[1]};return{type:"Feedback",payload:n}}}]),t}(),b=function(){function t(){e(this,t)}return n(t,null,[{key:"parse",value:function(e){var t=e.match(/^(\$[^=]+)=([^ ]*)\s*(.*)/);if(!t)return null;var n={name:t[1],value:t[2],message:_.trim(t[3],"()")};return{type:"Settings",payload:n}}}]),t}(),v=function(){function t(){e(this,t)}return n(t,null,[{key:"parse",value:function(e){var t=e.match(/^Grbl\s*(\d+\.\d+[a-zA-Z]?)/);if(!t)return null;var n={version:t[1]};return{type:"Startup",payload:n}}}]),t}(),y=function(){function t(){e(this,t)}return n(t,null,[{key:"parse",value:function(e){var t=e.match(/^\[Pgm End\]/);if(!t)return null;var n={};return{type:"Pgm End",payload:n}}}]),t}(),x=[s,r,d,c,l,m,u,p,g,f,h,b,v,y]}(c37.application.controller,c37.library.utility),function(e,t){t.object.namespace(e,"firmware.grbl.constants"),e.firmware.grbl.constants={GRBL:"Grbl",STATE:{IDLE:"Idle",RUN:"Run",HOLD:"Hold",DOOR:"Door",HOME:"Home",SLEEP:"Sleep",ALARM:"Alarm",CHECK:"Check"},REALTIME_COMMANDS:["~","!","?",""],MODAL_GROUPS:[{group:"motion",modes:["G0","G1","G2","G3","G38.2","G38.3","G38.4","G38.5","G80"]},{group:"coordinate",modes:["G54","G55","G56","G57","G58","G59"]},{group:"plane",modes:["G17","G18","G19"]},{group:"units",modes:["G20","G21"]},{group:"distance",modes:["G90","G91"]},{group:"feedrate",modes:["G93","G94"]},{group:"program",modes:["M0","M1","M2","M30"]},{group:"spindle",modes:["M3","M4","M5"]},{group:"coolant",modes:["M7","M8","M9"]}],ERRORS:[{code:1,description:"Expected command letter",help:"G-code words consist of a letter and a value. Letter was not found."},{code:2,description:"Bad number format",help:"Missing the expected G-code word value or numeric value format is not valid."},{code:3,description:"Invalid statement",help:"Grbl $' system command was not recognized or supported."},{code:4,description:"Value < 0",help:"Negative value received for an expected positive value."},{code:5,description:"Setting disabled",help:"Homing cycle failure. Homing is not enabled via settings."},{code:6,description:"Value < 3 usec",help:"Minimum step pulse time must be greater than 3usec."},{code:7,description:"EEPROM read fail. Using defaults",help:"An EEPROM read failed. Auto-restoring affected EEPROM to default values."},{code:8,description:"Not idle",help:"Grbl '$' command cannot be used unless Grbl is IDLE. Ensures smooth operation during a job."},{code:9,description:"G-code lock",help:"G-code commands are locked out during alarm or jog state."},{code:10,description:"Homing not enabled",help:"Soft limits cannot be enabled without homing also enabled."},{code:11,description:"Line overflow",help:"Max characters per line exceeded. Received command line was not executed."},{code:12,description:"Step rate > 30kHz",help:"Grbl '$' setting value cause the step rate to exceed the maximum supported."},{code:13,description:"Check Door",help:"Safety door detected as opened and door state initiated."},{code:14,description:"Line length exceeded",help:"Build info or startup line exceeded EEPROM line length limit. Line not stored."},{code:15,description:"Travel exceeded",help:"Jog target exceeds machine travel. Jog command has been ignored."},{code:16,description:"Invalid jog command",help:"Jog command has no '=' or contains prohibited g-code."},{code:20,description:"Unsupported command",help:"Unsupported or invalid g-code command found in block."},{code:21,description:"Modal group violation",help:"More than one g-code command from same modal group found in block."},{code:22,description:"Undefined feed rate",help:"Feed rate has not yet been set or is undefined."},{code:23,description:"Invalid gcode ID:23",help:"G-code command in block requires an integer value."},{code:24,description:"Invalid gcode ID:24",help:"More than one g-code command that requires axis words found in block."},{code:25,description:"Invalid gcode ID:25",help:"Repeated g-code word found in block."},{code:26,description:"Invalid gcode ID:26",help:"No axis words found in block for g-code command or current modal state which requires them."},{code:27,description:"Invalid gcode ID:27",help:"Line number value is invalid."},{code:28,description:"Invalid gcode ID:28",help:"G-code command is missing a required value word."},{code:29,description:"Invalid gcode ID:29",help:"G59.x work coordinate systems are not supported."},{code:30,description:"Invalid gcode ID:30",help:"G53 only allowed with G0 and G1 motion modes."},{code:31,description:"Invalid gcode ID:31",help:"Axis words found in block when no command or current modal state uses them."},{code:32,description:"Invalid gcode ID:32",help:"G2 and G3 arcs require at least one in-plane axis word."},{code:33,description:"Invalid gcode ID:33",help:"Motion command target is invalid."},{code:34,description:"Invalid gcode ID:34",help:"Arc radius value is invalid."},{code:35,description:"Invalid gcode ID:35",help:"G2 and G3 arcs require at least one in-plane offset word."},{code:36,description:"Invalid gcode ID:36",help:"Unused value words found in block."},{code:37,description:"Invalid gcode ID:37",help:"G43.1 dynamic tool length offset is not assigned to configured tool length axis."},{code:38,description:"Invalid gcode ID:38",help:"Tool number greater than max supported value."}],ALARMS:[{code:1,description:"Hard limit",help:"Hard limit has been triggered. Machine position is likely lost due to sudden halt. Re-homing is highly recommended."},{code:2,description:"Soft limit",help:"Soft limit alarm. G-code motion target exceeds machine travel. Machine position retained. Alarm may be safely unlocked."},{code:3,description:"Abort during cycle",help:"Reset while in motion. Machine position is likely lost due to sudden halt. Re-homing is highly recommended."},{code:4,description:"Probe fail",help:"Probe fail. Probe is not in the expected initial state before starting probe cycle when G38.2 and G38.3 is not triggered and G38.4 and G38.5 is triggered."},{code:5,description:"Probe fail",help:"Probe fail. Probe did not contact the workpiece within the programmed travel for G38.2 and G38.4."},{code:6,description:"Homing fail",help:"Homing fail. The active homing cycle was reset."},{code:7,description:"Homing fail",help:"Homing fail. Safety door was opened during homing cycle."},{code:8,description:"Homing fail",help:"Homing fail. Pull off travel failed to clear limit switch. Try increasing pull-off setting or check wiring."},{code:9,description:"Homing fail",help:"Homing fail. Could not find limit switch within search distances. Try increasing max travel, decreasing pull-off distance, or check wiring."}],SETTINGS:[{setting:"$0",description:"Step pulse time",units:"microseconds",help:"Sets time length per step. Minimum 3usec."},{setting:"$1",description:"Step idle delay",units:"milliseconds",help:"Sets a short hold delay when stopping to let dynamics settle before disabling steppers. Value 255 keeps motors enabled with no delay."},{setting:"$2",description:"Step pulse invert",units:"mask",help:"Inverts the step signal. Set axis bit to invert (00000ZYX)."},{setting:"$3",description:"Step direction invert",units:"mask",help:"Inverts the direction signal. Set axis bit to invert (00000ZYX)."},{setting:"$4",description:"Invert step enable pin",units:"boolean",help:"Inverts the stepper driver enable pin signal."},{setting:"$5",description:"Invert limit pins",units:"boolean",help:"Inverts the all of the limit input pins."},{setting:"$6",description:"Invert probe pin",units:"boolean",help:"Inverts the probe input pin signal."},{setting:"$10",description:"Status report options",units:"mask",help:"Alters data included in status reports."},{setting:"$11",description:"Junction deviation",units:"millimeters",help:"Sets how fast Grbl travels through consecutive motions. Lower value slows it down."},{setting:"$12",description:"Arc tolerance",units:"millimeters",help:"Sets the G2 and G3 arc tracing accuracy based on radial error. Beware: A very small value may effect performance."},{setting:"$13",description:"Report in inches",units:"boolean",help:"Enables inch units when returning any position and rate value that is not a settings value."},{setting:"$20",description:"Soft limits enable",units:"boolean",help:"Enables soft limits checks within machine travel and sets alarm when exceeded. Requires homing."},{setting:"$21",description:"Hard limits enable",units:"boolean",help:"Enables hard limits. Immediately halts motion and throws an alarm when switch is triggered."},{setting:"$22",description:"Homing cycle enable",units:"boolean",help:"Enables homing cycle. Requires limit switches on all axes."},{setting:"$23",description:"Homing direction invert",
units:"mask",help:"Homing searches for a switch in the positive direction. Set axis bit (00000ZYX) to search in negative direction."},{setting:"$24",description:"Homing locate feed rate",units:"mm/min",help:"Feed rate to slowly engage limit switch to determine its location accurately."},{setting:"$25",description:"Homing search seek rate",units:"mm/min",help:"Seek rate to quickly find the limit switch before the slower locating phase."},{setting:"$26",description:"Homing switch debounce delay",units:"milliseconds",help:"Sets a short delay between phases of homing cycle to let a switch debounce."},{setting:"$27",description:"Homing switch pull-off distance",units:"millimeters",help:"Retract distance after triggering switch to disengage it. Homing will fail if switch isn't cleared."},{setting:"$30",description:"Maximum spindle speed",units:"RPM",help:"Maximum spindle speed. Sets PWM to 100% duty cycle."},{setting:"$31",description:"Minimum spindle speed",units:"RPM",help:"Minimum spindle speed. Sets PWM to 0.4% or lowest duty cycle."},{setting:"$32",description:"Laser-mode enable",units:"boolean",help:"Enables laser mode. Consecutive G1/2/3 commands will not halt when spindle speed is changed."},{setting:"$100",description:"X-axis travel resolution",units:"step/mm",help:"X-axis travel resolution in steps per millimeter."},{setting:"$101",description:"Y-axis travel resolution",units:"step/mm",help:"Y-axis travel resolution in steps per millimeter."},{setting:"$102",description:"Z-axis travel resolution",units:"step/mm",help:"Z-axis travel resolution in steps per millimeter."},{setting:"$110",description:"X-axis maximum rate",units:"mm/min",help:"X-axis maximum rate. Used as G0 rapid rate."},{setting:"$111",description:"Y-axis maximum rate",units:"mm/min",help:"Y-axis maximum rate. Used as G0 rapid rate."},{setting:"$112",description:"Z-axis maximum rate",units:"mm/min",help:"Z-axis maximum rate. Used as G0 rapid rate."},{setting:"$120",description:"X-axis acceleration",units:"mm/sec^2",help:"X-axis acceleration. Used for motion planning to not exceed motor torque and lose steps."},{setting:"$121",description:"Y-axis acceleration",units:"mm/sec^2",help:"Y-axis acceleration. Used for motion planning to not exceed motor torque and lose steps."},{setting:"$122",description:"Z-axis acceleration",units:"mm/sec^2",help:"Z-axis acceleration. Used for motion planning to not exceed motor torque and lose steps."},{setting:"$130",description:"X-axis maximum travel",units:"millimeters",help:"Maximum X-axis travel distance from homing switch. Determines valid machine space for soft-limits and homing search distances."},{setting:"$131",description:"Y-axis maximum travel",units:"millimeters",help:"Maximum Y-axis travel distance from homing switch. Determines valid machine space for soft-limits and homing search distances."},{setting:"$132",description:"Z-axis maximum travel",units:"millimeters",help:"Maximum Z-axis travel distance from homing switch. Determines valid machine space for soft-limits and homing search distances."}]}}(c37.application.controller,c37.library.utility),function(e,t){var n=null,i=null,a=null,o={timer:null,state:null,status:!0},s={busy:!1},r=null,d=!1,c=!1,l={},m={IDLE:"Idle",RUN:"Run",HOLD:"Hold",ALARM:"Alarm"};t.object.namespace(e,"firmware.grbl.controller"),e.firmware.grbl.controller={initialize:function(t){return n=t,i=e.firmware.grbl.sender,a=e.firmware.grbl.message,n.on("data",function(t){var u=a.parse(t);return"Startup"===u.type?(c||(e.interface.status("isConnected"),c=!0),setTimeout(function(){d=!0},300),void(o.status=!1)):"Ok"===u.type?(s.busy=!1,void(i.state.remain.length>0&&i.state.received>0&&i.responseNext(n))):"Status"===u.type?(o.status=!1,e.viewer.position(u.payload.wpos),e.interface.position(u.payload.wpos),r=u.payload.activeState,r===m.IDLE&&i.state.finishedTime>0&&(e.interface.status("isEndProcess"),i.rewind(),n.write("M5\n")),void(r===m.HOLD&&"isPauseProcess"!==e.interface.state&&i.state.remain.length>0&&i.state.received>0&&e.interface.status("isPauseProcess"))):"Settings"===u.type?void(l[u.payload.name]=u.payload.value):void("Error"===u.type&&c37.library.message.operation.add({type:"danger",text:u.payload.message}))}),n.on("error",function(e){c37.library.message.operation.add({type:"error",text:JSON.stringify(e)})}),n.on("close",function(t){clearInterval(o.timer),e.interface.status("isDisconnected")}),this},open:function(){return new Promise(function(e,t){n.open(function(i){return i?t(!1):(c=!1,o.timer=setInterval(function(){n.isOpen()&&d&&(o.status||(o.status=!0,n.write("?")))},200),e(!0))})})},close:function(){return new Promise(function(t,i){n.close(function(n){return n?i(!1):(clearInterval(o.timer),e.interface.status("isDisconnected"),t(!0))})})},get settings(){return l},get status(){return i.status},get state(){return r},set state(e){r=e},get workFlowState(){return m},command:function(e,t,a){var o={load:function(e){return i.load(e.name,e.gcode),!a||a(!0)},start:function(e){return r=m.RUN,i.next(n),!a||a(!0)},pause:function(e){return r!==m.HOLD&&n.write("!"),!a||a(!0)},resume:function(e){return n.write("~"),setTimeout(function(){i.next(n)},30),!a||a(!0)},stop:function(){i.rewind(),d=!1,c=!0,n.write("!"),setTimeout(function(){return n.write(""),!a||a(!0)},400)},reset:function(){n.write("")},gcode:function(e){if(!s.busy){s.busy=!0;var t=e+"\n";return e.indexOf("$")>-1&&e.indexOf("$$")===-1&&setTimeout(function(){s.busy=!1},300),n.write(t),!a||a(!0)}}};o[e](t)},dispose:function(){}}}(c37.application.controller,c37.library.utility);