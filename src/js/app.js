"use strict";function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function t(e){this.handlers=e||{},this.lastArgs={cmd:null},this.lastFeedrate=null,this.isUnitsMm=!0,this.parseLine=function(e,t){var n=e;e.match(/^N/i)&&(e=e.replace(/^N\d+\s*/gi,"")),e=e.replace(/G00/i,"G0"),e=e.replace(/G0(\d)/i,"G$1"),e=e.replace(/([gmtxyzabcijkfst])/gi," $1"),e=e.replace(/([xyzabcijkfst])\s+/gi,"$1"),e=e.trim();var i=!1;if(e.match(/^(;|\(|<)/)?(e=n,i=!0):e=e.replace(/\(.*?\)/g,""),!e||i){var a={cmd:"empty or comment",text:e,origtext:n,indx:t,isComment:i},o=this.handlers.default;return o(a,t,this)}e=e.replace(/(;|\().*$/,"");var s=e.split(/\s+/);if(s){var r=s[0];r=r.toUpperCase(),i=!1,r.match(/^(G|M|T)/i)||(r=this.lastArgs.cmd,s.unshift(r));var a={cmd:r,text:e,origtext:n,indx:t,isComment:i,feedrate:null,plane:void 0};s.length>1&&!i&&s.splice(1).forEach(function(e){if(e&&e.length>0){var t=e[0].toLowerCase(),n=parseFloat(e.substring(1));a[t]=n}});var o=this.handlers[r]||this.handlers.default;if(a.isComment||(this.lastArgs=a),o){if(a.text.match(/\bG20\b/i)?this.isUnitsMm=!1:a.text.match(/\bG21\b/i)&&(this.isUnitsMm=!0),a.text.match(/F([\d.]+)/i)){var c=parseFloat(RegExp.$1);a.feedrate=c,this.lastFeedrate=c}else a.feedrate=this.lastFeedrate;return o(a,t,this)}console.error("No handler for gcode command!!!")}},this.parse=function(e){for(var t=e.split(/\r{0,1}\n/),n=0;n<t.length&&this.parseLine(t[n],n)!==!1;n++);}}function n(e,t){this.extraObjects=[],this.extraObjects.G17=[],this.extraObjects.G18=[],this.extraObjects.G19=[],this.offsetG92={x:0,y:0,z:0,e:0};var n={x:0,y:0,z:0,e:0,f:0,feedrate:null,extruding:!1},i=new THREE.Group,a="G17",o=[],s=void 0,r=[],c=0,d={min:{x:1e5,y:1e5,z:1e5},max:{x:-1e5,y:-1e5,z:-1e5}},l={min:{x:1e5,y:1e5,z:1e5},max:{x:-1e5,y:-1e5,z:-1e5}};this.newLayer=function(e){s={type:{},layer:o.length,z:e.z},o.push(s)},this.getLineGroup=function(e,n){void 0==s&&this.newLayer(e);var i=Math.round(e.e/1e3),a=(e.extruding?1e4:0)+i,o=new THREE.Color(e.extruding?16711935:this.colorG1);return e.g0?(a="g0",o=new THREE.Color(this.colorG0)):e.g2?(a="g2",o=new THREE.Color(this.colorG2)):e.arc&&(a="arc",o=new THREE.Color(39423)),n.indx>t&&(a="ghost",o=new THREE.Color(0)),void 0==s.type[a]&&(s.type[a]={type:a,feed:e.e,extruding:e.extruding,color:o,segmentCount:0,material:new THREE.LineBasicMaterial({opacity:e.extruding?.3:e.g2?.2:.5,transparent:!0,linewidth:1,vertexColors:THREE.FaceColors}),geometry:new THREE.Geometry},n.indx>t&&(s.type[a].material.opacity=.05)),s.type[a]},this.drawArc=function(e,t,n,i,a,o,s,r,c){var d=new THREE.ArcCurve(e,t,a,o,s,r),l=new THREE.LineBasicMaterial({color:43775,opacity:.5,transparent:!0}),m=new THREE.Geometry,u=0,p=n;d.getPoints(20).forEach(function(e){p=(i-n)/20*u+n,m.vertices.push(new THREE.Vector3(e.x,e.y,p)),u++});var g=new THREE.Line(m,l);return this.extraObjects[c].push(g),g},this.drawArcFrom2PtsAndCenter=function(e,t,n,i){var a=n.x-e.x,o=n.y-e.y,s=n.z-e.z,r=n.x-t.x,c=n.y-t.y,d=n.z-t.z;switch(i.plane){case"G18":var l=Math.atan(s/a),m=Math.atan(d/r);break;case"G19":var l=Math.atan(s/o),m=Math.atan(d/c);break;default:var l=Math.atan(o/a),m=Math.atan(c/r)}var u=n.distanceTo(e),p=n.distanceTo(t);Number(u.toFixed(2))!=Number(p.toFixed(2))&&console.log("Radiuses not equal. r1:",u,", r2:",p," with args:",i," rounded vals r1:",Number(u.toFixed(2)),", r2:",Number(p.toFixed(2)));var g=!0;switch(i.clockwise===!1&&(g=!1),i.plane){case"G19":o>=0&&(l+=Math.PI),c>=0&&(m+=Math.PI);break;default:a>=0&&(l+=Math.PI),r>=0&&(m+=Math.PI)}if(l===m&&g===!1)switch(i.plane){case"G18":var f=this.drawArc(n.x,n.z,-1*e.y,-1*t.y,u,l,m+2*Math.PI,g,"G18");break;case"G19":var f=this.drawArc(n.y,n.z,e.x,t.x,u,l,m+2*Math.PI,g,"G19");break;default:var f=this.drawArc(n.x,n.y,e.z,t.z,u,l,m+2*Math.PI,g,"G17")}else switch(i.plane){case"G18":var f=this.drawArc(n.x,n.z,-1*e.y,-1*t.y,u,l,m,g,"G18");break;case"G19":var f=this.drawArc(n.y,n.z,e.x,t.x,u,l,m,g,"G19");break;default:var f=this.drawArc(n.x,n.y,e.z,t.z,u,l,m,g,"G17")}return f},this.addSegment=function(e,t,n){r.push({p2:t,args:n});var a=this.getLineGroup(t,n),o=a.geometry;if(a.segmentCount++,t.arc){var s=new THREE.Vector3(e.x,e.y,e.z),c=new THREE.Vector3(t.x,t.y,t.z),m;if(null!=n.r){radius=parseFloat(n.r);var u=Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2)+Math.pow(t.z-e.z,2)),p=(e.x+t.x)/2,g=(e.y+t.y)/2,f=(e.z+t.z)/2,h=void 0,y=void 0,v=Math.sqrt(radius*radius-Math.pow(u/2,2)),b=void 0;switch(n.plane){case"G18":if(h={x:p+v*(e.z-t.z)/u,y:g+v*(t.y-e.y)/u,z:f+v*(t.x-e.x)/u},y={x:p-v*(e.z-t.z)/u,y:g-v*(t.y-e.y)/u,z:f-v*(t.x-e.x)/u},b=Math.atan2(e.z,e.x)-Math.atan2(t.z,t.x),(e.x-h.x)*(e.z+h.z)+(h.x-t.x)*(h.z+t.z)>=(e.x-y.x)*(e.z+y.z)+(y.x-t.x)*(y.z+t.z))var x=h,w=y;else var x=y,w=h;break;case"G19":if(h={x:p+v*(e.x-t.x)/u,y:g+v*(e.z-t.z)/u,z:f+v*(t.y-e.y)/u},y={x:p-v*(e.x-t.x)/u,y:g-v*(e.z-t.z)/u,z:f-v*(t.y-e.y)/u},(e.y-h.y)*(e.z+h.z)+(h.y-t.y)*(h.z+t.z)>=(e.y-y.y)*(e.z+y.z)+(y.y-t.y)*(y.z+t.z))var x=h,w=y;else var x=y,w=h;break;default:if(h={x:p+v*(e.y-t.y)/u,y:g+v*(t.x-e.x)/u,z:f+v*(t.z-e.z)/u},y={x:p-v*(e.y-t.y)/u,y:g-v*(t.x-e.x)/u,z:f-v*(t.z-e.z)/u},(e.x-h.x)*(e.y+h.y)+(h.x-t.x)*(h.y+t.y)>=(e.x-y.x)*(e.y+y.y)+(y.x-t.x)*(y.y+t.y))var x=h,w=y;else var x=y,w=h}m=t.clockwise===!0&&radius>=0||t.clockwise===!1&&radius<0?new THREE.Vector3(x.x,x.y,x.z):new THREE.Vector3(w.x,w.y,w.z)}else{var E={x:t.arci?e.x+t.arci:e.x,y:t.arcj?e.y+t.arcj:e.y,z:t.arck?e.z+t.arck:e.z};m=new THREE.Vector3(E.x,E.y,E.z)}var L=this.drawArcFrom2PtsAndCenter(s,c,m,n);t.g2=!0,t.threeObjArc=L,a=this.getLineGroup(t,n)}else o.vertices.push(new THREE.Vector3(e.x,e.y,e.z)),o.vertices.push(new THREE.Vector3(t.x,t.y,t.z)),o.colors.push(a.color),o.colors.push(a.color);t.extruding&&(d.min.x=Math.min(d.min.x,t.x),d.min.y=Math.min(d.min.y,t.y),d.min.z=Math.min(d.min.z,t.z),d.max.x=Math.max(d.max.x,t.x),d.max.y=Math.max(d.max.y,t.y),d.max.z=Math.max(d.max.z,t.z)),t.g0,l.min.x=Math.min(l.min.x,t.x),l.min.y=Math.min(l.min.y,t.y),l.min.z=Math.min(l.min.z,t.z),l.max.x=Math.max(l.max.x,t.x),l.max.y=Math.max(l.max.y,t.y),l.max.z=Math.max(l.max.z,t.z);var I;if(t.arc)I=t.threeObjArc;else{var z=255;t.extruding?z=16711935:t.g0?z=65280:t.g2||t.arc&&(z=13311);var G=new THREE.LineBasicMaterial({color:z,opacity:.5,transparent:!0}),o=new THREE.Geometry;o.vertices.push(new THREE.Vector3(e.x,e.y,e.z),new THREE.Vector3(t.x,t.y,t.z));var B=new THREE.Line(o,G);I=B}I.userData.p2=t,I.userData.args=n,i.add(I);var k=0;if(t.arc){for(var M=t.threeObjArc.geometry,T=0,S=0;S<M.vertices.length-1;S++)T+=M.vertices[S].distanceTo(M.vertices[S+1]);var C=new THREE.Vector3(e.x,e.y,e.z),H=new THREE.Vector3(t.x,t.y,t.z),R=C.distanceTo(H);k=T}else{var C=new THREE.Vector3(e.x,e.y,e.z),H=new THREE.Vector3(t.x,t.y,t.z);k=C.distanceTo(H)}k>0&&(this.totalDist+=k);var P=0;if(k>0){var A;A=n.feedrate>0?n.feedrate:100,P=k/A,P*=1.32}this.totalTime+=P,t.feedrate=n.feedrate,t.dist=k,t.distSum=this.totalDist,t.timeMins=P,t.timeMinsSum=this.totalTime},this.totalDist=0,this.totalTime=0;var m=!1;this.delta=function(e,t){return m?t:t-e},this.absolute=function(e,t){return m?e+t:t},this.addFakeSegment=function(e){var t={isFake:!0,text:e.text,indx:e.indx};t.text.match(/^(;|\(|<)/)&&(t.isComment=!0),r.push({p2:n,args:t})};var u=this,p=new this.GCodeParser({G0:function e(t,i){var a={x:void 0!==t.x?u.absolute(n.x,t.x)+u.offsetG92.x:n.x,y:void 0!==t.y?u.absolute(n.y,t.y)+u.offsetG92.y:n.y,z:void 0!==t.z?u.absolute(n.z,t.z)+u.offsetG92.z:n.z,e:void 0!==t.e?u.absolute(n.e,t.e)+u.offsetG92.e:n.e,f:void 0!==t.f?u.absolute(n.f,t.f):n.f};a.g0=!0,u.addSegment(n,a,t),n=a},G1:function e(t,i){var a={x:void 0!==t.x?u.absolute(n.x,t.x)+u.offsetG92.x:n.x,y:void 0!==t.y?u.absolute(n.y,t.y)+u.offsetG92.y:n.y,z:void 0!==t.z?u.absolute(n.z,t.z)+u.offsetG92.z:n.z,e:void 0!==t.e?u.absolute(n.e,t.e)+u.offsetG92.e:n.e,f:void 0!==t.f?u.absolute(n.f,t.f):n.f};u.delta(n.e,a.e)>0&&(a.extruding=u.delta(n.e,a.e)>0,void 0!=s&&a.z==s.z||u.newLayer(a)),u.addSegment(n,a,t),n=a},G2:function e(t,i,o){t.plane=a;var s={x:void 0!==t.x?u.absolute(n.x,t.x)+u.offsetG92.x:n.x,y:void 0!==t.y?u.absolute(n.y,t.y)+u.offsetG92.y:n.y,z:void 0!==t.z?u.absolute(n.z,t.z)+u.offsetG92.z:n.z,e:void 0!==t.e?u.absolute(n.e,t.e)+u.offsetG92.e:n.e,f:void 0!==t.f?u.absolute(n.f,t.f):n.f,arci:t.i?t.i:null,arcj:t.j?t.j:null,arck:t.k?t.k:null,arcr:t.r?t.r:null};s.arc=!0,s.clockwise=!0,t.clockwise===!1&&(s.clockwise=t.clockwise),u.addSegment(n,s,t),n=s},G3:function e(t,n,i){t.arc=!0,t.clockwise=!1,i.handlers.G2(t,n,i)},G17:function e(t){a="G17",u.addFakeSegment(t)},G18:function e(t){a="G18",u.addFakeSegment(t)},G19:function e(t){a="G19",u.addFakeSegment(t)},G20:function e(t){console.log("SETTING UNITS TO INCHES!!!"),u.isUnitsMm=!1,u.addFakeSegment(t)},G21:function e(t){u.isUnitsMm=!0,u.addFakeSegment(t)},G73:function e(t,n,i){console.log("G73 gcp:",i),i.handlers.G1(t)},G90:function e(t){m=!1,u.addFakeSegment(t)},G91:function e(t){m=!0,u.addFakeSegment(t)},G92:function e(t){var i=n;u.offsetG92.x=void 0!==t.x?0===t.x?i.x:i.x-t.x:0,u.offsetG92.y=void 0!==t.y?0===t.y?i.y:i.y-t.y:0,u.offsetG92.z=void 0!==t.z?0===t.z?i.z:i.z-t.z:0,u.offsetG92.e=void 0!==t.e?0===t.e?i.e:i.e-t.e:0,u.addFakeSegment(t)},M30:function e(t){u.addFakeSegment(t)},M82:function e(t){u.addFakeSegment(t)},M84:function e(t){u.addFakeSegment(t)},default:function e(t,n){u.addFakeSegment(t)}});p.parse(e),this.isUnitsMm=p.isUnitsMm;var g=new THREE.Object3D;for(var f in o){var s=o[f];for(var h in s.type){var y=s.type[h],v=this.convertLineGeometryToBufferGeometry(y.geometry,y.color);g.add(new THREE.Line(v,y.material,THREE.LinePieces))}}this.extraObjects.G17.forEach(function(e){var t=this.convertLineGeometryToBufferGeometry(e.geometry,e.material.color);g.add(new THREE.Line(t,e.material))},this),this.extraObjects.G18.forEach(function(e){var t=this.convertLineGeometryToBufferGeometry(e.geometry,e.material.color),n=new THREE.Line(t,e.material);n.rotateOnAxis(new THREE.Vector3(1,0,0),Math.PI/2),g.add(n)},this),this.extraObjects.G19.forEach(function(e){var t=this.convertLineGeometryToBufferGeometry(e.geometry,e.material.color),n=new THREE.Line(t,e.material);n.rotateOnAxis(new THREE.Vector3(1,0,0),Math.PI/2),n.rotateOnAxis(new THREE.Vector3(0,1,0),Math.PI/2),g.add(n)},this);var b=1,x=new THREE.Vector3(d.min.x+(d.max.x-d.min.x)/2,d.min.y+(d.max.y-d.min.y)/2,d.min.z+(d.max.z-d.min.z)/2),w=new THREE.Vector3(l.min.x+(l.max.x-l.min.x)/2,l.min.y+(l.max.y-l.min.y)/2,l.min.z+(l.max.z-l.min.z)/2);return g.userData.bbbox2=l,g.userData.lines=r,g.userData.layers=o,g.userData.center2=w,g.userData.extraObjects=this.extraObjects,g.userData.threeObjs=i,g}function a(e,t){for(var n=new Float32Array(3*e.vertices.length),i=new Float32Array(3*e.vertices.length),a=800,o=new THREE.BufferGeometry,s=0;s<e.vertices.length;s++){var r=e.vertices[s].x,c=e.vertices[s].y,d=e.vertices[s].z;n[3*s]=r,n[3*s+1]=c,n[3*s+2]=d,i[3*s]=t.r,i[3*s+1]=t.g,i[3*s+2]=t.b}return o.addAttribute("position",new THREE.BufferAttribute(n,3)),o.addAttribute("color",new THREE.BufferAttribute(i,3)),o.computeBoundingSphere(),o}function o(e,t,i){if(1===e.length){var a=e[0],o=a.name,s=o.lastIndexOf("."),r=o.substr(s+1).toLowerCase();if(u=o.substr(0,s),u=u.replace(/\ - (\d{4})-(\d{2})-(\d{2}) (\d{2})-(\d{2})-(\d{2})/,""),u=u.replace(/\ - (\d{4})-(\d{2})-(\d{2}) (\d{2}).(\d{2}).(\d{2})/,""),_fileName2=u,!(t.indexOf(r)>0))return i("Arquivo não suportado");var c=new FileReader;c37.application.controller.reset(function(e){e&&(c.onload=function(e){switch(p=e.target.result,r){case"nc":c37.application.controller.viewer.reset();var t=n(p);c37.application.controller.viewer.scene.add(t),c37.application.controller.viewer.objectsInScene.push(t),c37.application.controller.viewer.information(t),c37.application.controller.viewer.locate(t),m=!0}return i(!0)},c.readAsText(a))})}}var s=function(){function e(e,t){var n=[],i=!0,a=!1,o=void 0;try{for(var s=e[Symbol.iterator](),r;!(i=(r=s.next()).done)&&(n.push(r.value),!t||n.length!==t);i=!0);}catch(e){a=!0,o=e}finally{try{!i&&s.return&&s.return()}finally{if(a)throw o}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),c=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();!function(e,t,n){var i="1.0.0",a=["ciro.maciel@c37.co","andrea.maciel@c37.co"],o={name:"C37-CONTROLLER",debug:!1,version:1,stores:{settings:{uuid:{type:"string",index:!0},value:{type:"string",index:!1}}}},s={initialize:function e(n){t.manager.initialize(o,function(e){if(!e){var t={viewPort:document.querySelector("main")};return s.viewer.initialize(),s.interface._initialize(t),!n||n(!0)}throw new Error("Application - Initialize - Failed to Initialize the Local Database \n http://controller.c37.co/docs/errors.html#application-initialize")})},reset:function e(t){return!t||t(!0)}};e.c37=e.c37||{},e.c37.application=e.c37.application||{},e.c37.application.controller=s,e.onload=function(){e.c37.application.controller.initialize(function(e){if(e)return!0;throw new Error("application initialize - error")})}}(window,c37.library.database,c37.library.plane),function(e,t,n){function a(e){var t=!0,i=new n.BoundingBoxHelper(e,16711680);i.update(),this.bboxHelper=i;var a="#0d0d0d",r=new n.LineDashedMaterial({vertexColors:!1,color:a,dashSize:1,gapSize:1,linewidth:1,transparent:!0,opacity:.3}),c=0,d=-4,l=5,m=i.box.min.x,u=i.box.min.y,p=i.box.max.x,g=i.box.max.y,f=i.box.min.z,h=i.box.max.z,v=new n.Geometry;v.vertices.push(new n.Vector3(m,u+d,c),new n.Vector3(m,u+d-l,c),new n.Vector3(m,u+d-l,c),new n.Vector3(p,u+d-l,c),new n.Vector3(p,u+d-l,c),new n.Vector3(p,u+d,c)),v.computeLineDistances();var b=new n.Line(v,r,n.LineSegments);b.type=n.Lines;var x="X "+(p-m).toFixed(2);x+=t?" mm":" in";var w=s({x:m+1,y:u+d-l-3,z:c,text:x,color:a,opacity:.3,size:2}),E=-4,L=new n.Geometry;L.vertices.push(new n.Vector3(m+E,u,c),new n.Vector3(m+E-l,u,c),new n.Vector3(m+E-l,u,c),new n.Vector3(m+E-l,g,c),new n.Vector3(m+E-l,g,c),new n.Vector3(m+E,g,c)),L.computeLineDistances();var I=new n.Line(L,r,n.LineSegments);I.type=n.Lines;var x="Y "+(g-u).toFixed(2);x+=t?" mm":" in";var z=s({x:m+E-l,y:u-3,z:c,text:x,color:a,opacity:.3,size:2}),G=new n.Geometry,B=2;G.vertices.push(new n.Vector3(p,u,f),new n.Vector3(p+l,u,f),new n.Vector3(p+l,u,f),new n.Vector3(p+l,u,h),new n.Vector3(p+l,u,h),new n.Vector3(p,u,h)),G.computeLineDistances();var k=new n.Line(G,r,n.LineSegments);k.type=n.Lines;var x="Z "+(h-f).toFixed(2);x+=t?" mm":" in";var M=s({x:p+E+l,y:u-3,z:c,text:x,color:a,opacity:.3,size:2});M.rotateX(Math.PI/2);var T=M.position;M.position.set(T.x+5,T.y+3,T.z),this.decorate=new n.Object3D,this.decorate.add(b),this.decorate.add(w),this.decorate.add(I),this.decorate.add(z),this.decorate.add(k),this.decorate.add(M);var S=e.userData.lines,C=S[S.length-1].p2,H=o(C.timeMinsSum),x="Tempo Estimado: "+H+", Distancia Total: "+C.distSum.toFixed(2);x=t?x+" mm":x+" in";var R=s({x:m+1,y:u+d-l-6,z:c,text:x,color:a,opacity:.3,size:2});this.decorate.add(R),y.add(this.decorate),N.push(this.decorate)}function o(e){var t=60*e,n=~~(t/3600),e=~~(t%3600/60),i=t%60,a="";return n>0&&(a+=""+n+"h "+(e<10?"0":"")),a+=""+e+"m "+(i<10?"0":""),a+=""+i.toFixed(0)+"s"}function s(e){var t,i,a,o;return n.FontUtils?(n.FontUtils.loadFace(ThreeHelvetiker),t=n.FontUtils.generateShapes(e.text,{font:"helvetiker",size:e.size?e.size:10}),i=new n.ShapeGeometry(t),a=new n.MeshBasicMaterial({color:e.color,transparent:!0,opacity:e.opacity?e.opacity:.5}),o=new n.Mesh(i,a),o.position.x=e.x,o.position.y=e.y,o.position.z=e.z,o):void console.error("THREE.FontUtils not defined per bug in r73 of three.js. So not making text.")}function c(){requestAnimationFrame(c),b.render(y,v)}function d(e){T.position.set(e.x,e.y,e.z)}function l(){if(N.length>0)for(var e=0;e<N.length;e++)y.remove(N[e]),_.remove(N[e]);m(G)}function m(e){e?q=e:e=q,e||(e=new n.GridHelper(F,j,10));var t=new n.BoundingBoxHelper(e,16711680);t.update();var i=t,a=t.box.min.x,o=t.box.min.y,s=t.box.max.x,r=t.box.max.y,c=t.box.min.z,d=t.box.max.z;if(e.userData&&e.userData.center2){var l=e.userData;l.bbox2=t.box,l.center2.x=a+(s-a)/2,l.center2.y=o+(r-o)/2,l.center2.z=c+(d-c)/2}else{var l={};l.center2={},l.center2.x=a+(s-a)/2+F/2,l.center2.y=o+(r-o)/2+j/2,l.center2.z=c+(d-c)/2}O.reset();var m=s-a,u=r-o,p=d-c,g=50,f=50,h=50,y=Math.max(m,u,p),v=2*y;O.object.position.x=l.center2.x,O.object.position.y=l.center2.y,O.object.position.z=l.center2.z+v,O.target.x=l.center2.x,O.target.y=l.center2.y,O.target.z=l.center2.z;var b=2.2*Math.atan(y/(2*v))*(180/Math.PI);if(!isNaN(b)){O.object.fov=b;var x=v,w=O.object,E=O.target.clone(),L=(new n.Vector3).subVectors(w.position,E).length(),I=w.up.clone(),z=new n.Quaternion;w.translateZ(x-L),I.y=1,I.x=0,I.z=0,z.setFromAxisAngle(I,.5),I.y=0,I.x=1,I.z=0,z.setFromAxisAngle(I,.5),w.position.applyQuaternion(z),I.y=0,I.x=0,I.z=1,z.setFromAxisAngle(I,.5),w.lookAt(E),O.object.updateProjectionMatrix()}}function u(e){var t=y.getObjectByName(e,!0);t.material.color.setHex(16711680),t.material.needsUpdate=!0}function p(e,t,i){var a=document.createElement("canvas"),o=a.getContext("2d"),s=null,r=100,c=0,d=7,l=i.text;i.size&&(d=i.size),o.font="normal "+r+"px Arial",s=o.measureText(l);var c=s.width;a.width=c,a.height=r,o.font="normal "+r+"px Arial",o.textAlign="center",o.textBaseline="middle",o.fillStyle=i.color,o.fillText(l,c/2,r/2);var m=new n.Texture(a);m.needsUpdate=!0,m.minFilter=n.LinearFilter;var u=new n.SpriteMaterial({map:m,transparent:!0,opacity:.6});u.transparent=!0;var p=new n.Object3D;p.position.x=i.x,p.position.y=i.y,p.position.z=i.z;var g=new n.Sprite(u);return p.textHeight=d,p.textWidth=c/r*p.textHeight,"2d"==t?g.scale.set(p.textWidth/c,p.textHeight/r,1):g.scale.set(c/r*d,d,1),p.add(g),p}function g(t){return t=t.getBoundingClientRect(),{left:t.left+e.scrollX,top:t.top+e.scrollY}}function f(e){if(e.userData){var t=$("#"+e.userData.link),i=t.parent(),a=i.children("input");if(e.material&&"Mesh"!=e.type){var o=a.prop("checked");if(o)return e.material.color.setHex(e.userData.color),e.userData.selected=!1,a.prop("checked",!1),void t.css("color","black");e.material.color.setRGB(1,.1,.1)}t.css("color","red"),a.prop("checked",!0),e.userData.selected=!0}"undefined"!=typeof boundingBox&&y.remove(boundingBox);var s=(new n.Box3).setFromObject(e);BBmaterial=new n.LineDashedMaterial({color:11184810,dashSize:5,gapSize:4,linewidth:2}),BBgeometry=new n.Geometry,BBgeometry.vertices.push(new n.Vector3(s.min.x-1,s.min.y-1,0),new n.Vector3(s.min.x-1,s.max.y+1,0),new n.Vector3(s.max.x+1,s.max.y+1,0),new n.Vector3(s.max.x+1,s.min.y-1,0),new n.Vector3(s.min.x-1,s.min.y-1,0)),BBgeometry.computeLineDistances(),boundingBoxLines=new n.Line(BBgeometry,BBmaterial),boundingBox=new n.Group,boundingBox.add(boundingBoxLines);var r=parseFloat(s.max.x-s.min.x).toFixed(2),c=parseFloat(s.max.y-s.min.y).toFixed(2);widthlabel=this.makeSprite(this.scene,"webgl",{x:s.max.x+30,y:s.max.y-(s.max.y-s.min.y)/2+10,z:0,text:"W: "+r+"mm",color:"#aaaaaa",size:6}),boundingBox.add(widthlabel),heightlabel=this.makeSprite(this.scene,"webgl",{x:s.max.x-(s.max.x-s.min.x)/2+10,y:s.max.y+10,z:0,text:"H: "+c+"mm",color:"#aaaaaa",size:6}),boundingBox.add(heightlabel),boundingBox.name="Bounding Box",y.add(boundingBox)}function h(e){var t=new n.Group,a=0,o=0,s=new n.LineBasicMaterial({color:8947848,opacity:.5}),c=new n.Geometry;for(c.vertices.push(new n.Vector3(-(F/2),0,0)),c.vertices.push(new n.Vector3(F/2,0,0)),r=0;r<360;r+=10){var d=new n.Line(c,s),l=0+e*Math.cos(r*(Math.PI/180)),m=0+e*Math.sin(r*(Math.PI/180));for(d.position.y=l,d.position.z=m,t.add(d),i=-(F/2);i<F/2;i+=10){var u=new n.Geometry;u.vertices.push(new n.Vector3(i,o,a)),u.vertices.push(new n.Vector3(i,l,m));var p=new n.Line(u,s);t.add(p)}a=m,o=l}y.add(t)}var y,v,b,x,w,E,L,I,z,G,B,k,M,T,S,C,H,R,P,A,O,D,F,j,V=20,N=[],_;R=e.innerWidth,P=e.innerHeight;var q;t.viewer={initialize:function e(){A=new n.Raycaster,_=new n.Group,t.viewer.init3D(),c()},init3D:function t(){y=new n.Scene,v=new n.PerspectiveCamera(75,e.innerWidth/e.innerHeight,1,1e4),v.position.z=470;var i=!!e.CanvasRenderingContext2D,a=function(){try{return!!e.WebGLRenderingContext&&!!document.createElement("canvas").getContext("experimental-webgl")}catch(e){return!1}}();a?b=new n.WebGLRenderer({autoClearColor:!0,antialias:!1}):i&&(b=new n.CanvasRenderer),document.getElementById("renderArea").appendChild(b.domElement),b.setClearColor(16777215,1),b.clear(),x=document.getElementById("renderArea").clientWidth-2,w=document.getElementById("renderArea").clientHeight-2,v.aspect=x/w,b.setSize(x,w),v.updateProjectionMatrix(),O=new n.OrbitControls(v,b.domElement),O.target.set(0,0,0),O.enableRotate=!0,O.enableZoom=!0,O.enableKeys=!1,O.mouseButtons={PAN:n.MOUSE.LEFT,ZOOM:n.MOUSE.MIDDLE,ORBIT:n.MOUSE.RIGHT},D=new n.TransformControls(v,b.domElement),D.setMode("translate"),_.add(D);var o=new n.DirectionalLight(16777215);o.position.set(-500,-500,1).normalize(),o.name="Light1;",_.add(o);var s=new n.DirectionalLight(16777215);s.name="Light2",s.position.set(1,0,1).normalize(),_.add(s),F=400,j=400,G=new n.GridHelper(F,j,10),G.setColors(255,7368816),G.position.y=F/2,G.position.x=j/2,G.position.z=0,G.material.opacity=.15,G.material.transparent=!0,G.receiveShadow=!1,this.grid=G,G.name="GridHelper",_.add(G),T=new n.Object3D;var r=new n.LineBasicMaterial({color:16711680}),c=new n.Mesh(new n.CylinderGeometry(0,5,40,15,1,!1),new n.MeshPhongMaterial({color:255,specular:255,shininess:100}));c.overdraw=!0,c.rotation.x=-90*Math.PI/180,c.position.z=20,c.material.opacity=.4,c.material.transparent=!0,c.castShadow=!1,T.add(c),T.position.x=0,T.position.y=0,_.add(T);var d=new n.Object3D;B=new n.AxisHelper(100),B.material.transparent=!0,B.material.opacity=.8,B.material.depthWrite=!1,B.position.set(0,0,-1e-4),d.add(B);var l=p(y,"webgl",{x:110,y:0,z:0,text:"X",color:"#ff0000"}),u=p(y,"webgl",{x:0,y:110,z:0,text:"Y",color:"#00ff00"}),g=p(y,"webgl",{x:0,y:0,z:110,text:"Z",color:"#0000ff"});d.add(l),d.add(u),d.add(g),B=d,_.add(B),m(),y.add(_)},reset3D:function e(){for(var t=0;t<N.length;t++)y.remove(N[t]),N.splice(t,1);y.updateMatrixWorld(),l()},get scene(){return y},get objectsInScene(){return N},position:d,information:a,locate:m,reset:l},e.onresizeszzz=function(){x=document.getElementById("renderArea").clientWidth-2,w=document.getElementById("renderArea").clientHeight-2,b.setSize(x,w),v.aspect=x/w,v.updateProjectionMatrix(),O.reset()}}(window,c37.application.controller,window.THREE);var d=0,l=null,m=!1,u="",p="",g=65280,f=255,h=10066176;!function(e,t){var n=require("serialport"),i=null,a=null;t.object.namespace(e,"engine"),e.engine={list:function e(){return new Promise(function(e,t){n.list(function(n,i){n?t(n):e(i.filter(function(e){return!e.comName.contains("ttyS")}))})})},connect:function t(o,s,r){i=r;var c=new n(o,{autoOpen:!1,baudRate:s,parser:n.parsers.readline("\n")});if("Grbl"===i)a=e.firmware.grbl.controller.initialize(c);else if("C37"!==i)throw new Error("Not supported controller: "+i);return a.open()},disconnect:function e(){return a.close()},command:function e(t,n,i){return a.command(t,n,i)},get state(){return a?a.state:null},get workFlowState(){return a?a.workFlowState:null}}}(c37.application.controller,c37.library.utility),function(e,t,n){function i(){E.x=document.getElementById("strong-axis-position-x"),E.y=document.getElementById("strong-axis-position-y"),E.z=document.getElementById("strong-axis-position-z")}function a(){window.onkeyup=function(e){32===e.keyCode&&(document.getElementById("button-milling-start").classList.contains("disabled")?setTimeout(function(){document.getElementById("button-milling-pause").click()},100):setTimeout(function(){document.getElementById("button-milling-start").click()},100))},window.onkeydown=function(e){39===e.keyCode&&document.getElementById("button-command-x-right").click(),37===e.keyCode&&document.getElementById("button-command-x-left").click(),40===e.keyCode&&document.getElementById("button-command-y-right").click(),38===e.keyCode&&document.getElementById("button-command-y-left").click(),33===e.keyCode&&document.getElementById("button-command-z-up").click(),34===e.keyCode&&document.getElementById("button-command-z-down").click()},document.getElementById("c37-cnc").addEventListener("click",function(){z.openExternal("http://c37.co")}),document.getElementById("install-internet").addEventListener("click",function(){z.openExternal("https://www.google.com.br/webhp?sourceid=chrome-instant&ion=1&espv=2&ie=UTF-8#q=%22%2Fdev%2Fttyacm0%22+permission+denied")}),document.getElementById("install-video").addEventListener("click",function(){z.openExternal("https://www.youtube.com/watch?v=N6aoacx8ruw")}),document.getElementById("c37-controller-group").addEventListener("click",function(){z.openExternal("https://www.facebook.com/groups/c37.controller/")}),document.getElementById("link-donation").addEventListener("click",function(){z.openExternal("http://mpago.la/SeiL")});var t=document.getElementById("input-file-manager");t.addEventListener("change",function(){return o(this.files,this.accept,function(e){if(e)return r("isOpenFile"),!0}),this.value=""}),document.getElementById("button-file-open").onclick=function(){this.classList.contains("disabled")||(t.accept=".nc",t.click())},document.getElementById("button-file-reload").onclick=function(){this.classList.contains("disabled")||e.file.reload().then(function(e){e&&(r("isOpenFile"),document.getElementById("list-file-commands").scrollTop=0)})},document.getElementById("text-command-send").onkeydown=function(t){if(13===t.keyCode&&this.value){var n=this.value;n.toLowerCase().indexOf("m")>0?e.engine.command("gcode",n):e.engine.command("gcode","G91"+n),this.value=""}},document.getElementById("button-command-reset").onclick=function(){this.classList.contains("disabled")||e.engine.command("gcode","")},document.getElementById("button-axis-zero-define").onclick=function(){this.classList.contains("disabled")||(e.engine.command("gcode","G10 P0 L20 X0 Y0 Z0"),setTimeout(function(){e.engine.command("gcode","G10 P0 L20 X0 Y0 Z0")},50))},document.getElementById("button-axis-zero-return").onclick=function(){this.classList.contains("disabled")||(e.engine.command("gcode","G90 G0 Z5"),setTimeout(function(){e.engine.command("gcode","G90 G0 Z5")},50),setTimeout(function(){e.engine.command("gcode","G90 G0 X0 Y0")},150),setTimeout(function(){e.engine.command("gcode","G90 G0 Z0")},250))},document.getElementById("button-probe-start").onclick=function(){this.classList.contains("disabled")||e.probe.start()},document.getElementById("button-probe-collect").onclick=function(){this.classList.contains("disabled")||e.probe.collect(this.querySelector("span"))},document.getElementById("button-probe-stop").onclick=function(){this.classList.contains("disabled")||("Parar"===this.querySelector("span").textContent?e.probe.stop():e.probe.finish())},document.getElementById("button-probe-remove").onclick=function(){this.classList.contains("disabled")||e.probe.remove()},document.getElementById("button-milling-start").onclick=function(){this.classList.contains("disabled")||(e.engine.state===e.engine.workFlowState.IDLE?e.engine.command("load",{name:u,gcode:p},function(t){t&&e.engine.command("start",null,function(e){r("isStartProcess")})}):e.engine.state===e.engine.workFlowState.HOLD&&e.engine.command("resume",null,function(e){e&&setTimeout(function(){r("isStartProcess")},200)}))},document.getElementById("button-milling-pause").onclick=function(){this.classList.contains("disabled")||e.engine.command("pause",null,function(e){e&&r("isPauseProcess")})},document.getElementById("button-milling-stop").onclick=function(){this.classList.contains("disabled")||e.engine.command("stop",null,function(e){e&&setTimeout(function(){r("isStopProcess")},200)})},document.getElementById("button-command-x-left").onclick=function(){if(!this.classList.contains("disabled")){var t=document.getElementById("button-command-displace").dataset.selected;e.engine.command("gcode",n.string.format("G91 G0 X-{0}",[1*t]))}},document.getElementById("button-command-x-right").onclick=function(){if(!this.classList.contains("disabled")){var t=document.getElementById("button-command-displace").dataset.selected;e.engine.command("gcode",n.string.format("G91 G0 X{0}",[1*t]))}},document.getElementById("button-command-y-left").onclick=function(){if(!this.classList.contains("disabled")){var t=document.getElementById("button-command-displace").dataset.selected;e.engine.command("gcode",n.string.format("G91 G0 Y{0}",[1*t]))}},document.getElementById("button-command-y-right").onclick=function(){if(!this.classList.contains("disabled")){var t=document.getElementById("button-command-displace").dataset.selected;e.engine.command("gcode",n.string.format("G91 G0 Y-{0}",[1*t]))}},document.getElementById("button-command-z-up").onclick=function(){if(!this.classList.contains("disabled")){var t=document.getElementById("button-command-displace").dataset.selected;e.engine.command("gcode",n.string.format("G91 G0 Z{0}",[1*t]))}},document.getElementById("button-command-z-down").onclick=function(){if(!this.classList.contains("disabled")){var t=document.getElementById("button-command-displace").dataset.selected;e.engine.command("gcode",n.string.format("G91 G0 Z-{0}",[1*t]))}},document.getElementById("button-home").onclick=function(){e.viewer.locate()}}function s(e,n,i){if("isDisplay"===e){document.getElementById("strong-file-name").classList.remove("hide"),document.getElementById("strong-file-name").textContent=n.name;var a=document.getElementById("list-file-commands").querySelectorAll("li");[].forEach.call(a,function(e){e.classList.contains("command-empty")||e.parentNode.removeChild(e)}),document.getElementById("list-file-commands").querySelector("li:first-child").classList.add("hide"),n.data.forEach(function(e){var t=document.createElement("li"),n=document.createElement("div");n.textContent=e,t.appendChild(n),document.getElementById("list-file-commands").appendChild(t)}),document.getElementById("span-command-length").textContent=n.data.length,document.getElementById("progress-command-process").max=n.data.length}if("isStartProcess"===e&&w.interval.push(setInterval(function(){document.getElementById("span-file-time-worked").textContent=t().subtract(t().subtract(w.duration++,"seconds")).format("HH:mm:ss")},1e3)),"isPauseProcess"===e&&w.interval.forEach(function(e){clearInterval(e)}),"isEndProcess"===e&&(w.interval.forEach(function(e){clearInterval(e)}),w.duration=1),"isUpdateProcess"===e&&(document.getElementById("span-command-send").textContent=i,document.getElementById("progress-command-process").value=i,document.getElementById("list-file-commands").scrollTop=21*i),"isClear"===e){s("isEndProcess",null,null),document.getElementById("strong-file-name").classList.add("hide"),document.getElementById("strong-file-name").textContent="";var a=document.getElementById("list-file-commands").querySelectorAll("li");[].forEach.call(a,function(e){e.classList.contains("command-empty")||e.parentNode.removeChild(e)}),document.getElementById("list-file-commands").querySelector("li:first-child").classList.remove("hide"),document.getElementById("span-command-length").textContent="0",document.getElementById("progress-command-process").max="0",document.getElementById("span-command-send").textContent="0",document.getElementById("progress-command-process").value=0,document.getElementById("span-file-time-worked").textContent="00:00:00"}}function r(e){I=e;var t=document.getElementById("strong-connection-status"),n=document.getElementById("i-connection-status"),i=document.getElementById("button-settings-open"),a=document.getElementById("button-file-open"),o=document.getElementById("button-file-reload"),s=document.getElementById("text-command-send"),r=document.getElementById("button-command-reset"),d=document.getElementById("button-axis-home"),l=document.getElementById("button-axis-zero-define"),u=document.getElementById("button-axis-zero-return"),p=document.getElementById("icon-probe-settings"),g=document.getElementById("button-probe-mode-three-points"),f=document.getElementById("button-probe-mode-grid-points"),h=document.getElementById("button-probe-start"),y=document.getElementById("button-probe-collect"),v=document.getElementById("button-probe-stop"),b=document.getElementById("button-probe-remove"),x=document.getElementById("button-milling-start"),w=document.getElementById("button-milling-pause"),E=document.getElementById("button-milling-stop"),z=document.getElementById("button-command-displace-3"),G=document.getElementById("button-command-displace-2"),B=document.getElementById("button-command-displace-1"),k=document.getElementById("button-command-displace-01"),M=document.getElementById("button-command-displace-001"),T=document.getElementById("button-command-x-left"),S=document.getElementById("button-command-x-right"),C=document.getElementById("button-command-y-left"),H=document.getElementById("button-command-y-right"),R=document.getElementById("button-command-z-up"),P=document.getElementById("button-command-z-down"),A=document.getElementById("button-toggle-spindle"),O=document.getElementById("checkbox-toggle-spindle"),D=document.getElementById("button-toggle-coolant"),$=document.getElementById("checkbox-toggle-coolant");
return"isDisconnected"===e&&(t.textContent="Desconectado",n.className="icon-connection-out",i.classList.add("disabled"),o.classList.add("disabled"),s.classList.add("disabled"),s.disabled=!0,r.classList.add("disabled"),l.classList.add("disabled"),u.classList.add("disabled"),p.classList.add("disabled"),g.classList.add("disabled"),f.classList.add("disabled"),h.classList.add("disabled"),y.classList.add("disabled"),v.classList.add("disabled"),b.classList.add("disabled"),document.getElementById("progress-planner").value=0,x.classList.add("disabled"),w.classList.add("disabled"),E.classList.add("disabled"),z.classList.add("disabled"),G.classList.add("disabled"),B.classList.add("disabled"),k.classList.add("disabled"),M.classList.add("disabled"),T.classList.add("disabled"),S.classList.add("disabled"),C.classList.add("disabled"),H.classList.add("disabled"),R.classList.add("disabled"),P.classList.add("disabled"),A.classList.remove("enable"),A.classList.add("disabled"),O.disabled=!0,O.checked=!1,D.classList.remove("enable"),D.classList.add("disabled"),$.disabled=!0,$.checked=!1,c(L)),"isConnected"===e&&(t.textContent="Conectado",n.className="icon-connection-in",i.classList.remove("disabled"),s.classList.remove("disabled"),s.disabled=!1,r.classList.remove("disabled"),l.classList.remove("disabled"),u.classList.remove("disabled"),p.classList.remove("disabled"),g.classList.remove("disabled"),f.classList.remove("disabled"),h.classList.remove("disabled"),y.classList.add("disabled"),v.classList.add("disabled"),m?x.classList.remove("disabled"):x.classList.add("disabled"),w.classList.add("disabled"),E.classList.add("disabled"),z.classList.remove("disabled"),G.classList.remove("disabled"),B.classList.remove("disabled"),k.classList.remove("disabled"),M.classList.remove("disabled"),T.classList.remove("disabled"),S.classList.remove("disabled"),C.classList.remove("disabled"),H.classList.remove("disabled"),R.classList.remove("disabled"),P.classList.remove("disabled"),A.classList.add("enable"),A.classList.remove("disabled"),O.disabled=!1,D.classList.add("enable"),D.classList.remove("disabled"),$.disabled=!1),"isOpenFile"===e&&(o.classList.remove("disabled"),"Conectado"==t.textContent&&x.classList.remove("disabled"),w.classList.add("disabled"),E.classList.add("disabled")),"isStartProcess"===e&&(i.classList.add("disabled"),a.classList.add("disabled"),o.classList.add("disabled"),s.classList.add("disabled"),s.disabled=!0,r.classList.add("disabled"),l.classList.add("disabled"),u.classList.add("disabled"),x.classList.add("disabled"),w.classList.remove("disabled"),E.classList.remove("disabled"),z.classList.add("disabled"),G.classList.add("disabled"),B.classList.add("disabled"),k.classList.add("disabled"),M.classList.add("disabled"),T.classList.add("disabled"),S.classList.add("disabled"),C.classList.add("disabled"),H.classList.add("disabled"),R.classList.add("disabled"),P.classList.add("disabled")),"isPauseProcess"===e&&(o.classList.add("disabled"),s.classList.add("disabled"),s.disabled=!0,l.classList.add("disabled"),u.classList.add("disabled"),x.classList.remove("disabled"),w.classList.add("disabled"),E.classList.remove("disabled"),z.classList.add("disabled"),G.classList.add("disabled"),B.classList.add("disabled"),k.classList.add("disabled"),M.classList.add("disabled"),T.classList.add("disabled"),S.classList.add("disabled"),C.classList.add("disabled"),H.classList.add("disabled"),R.classList.add("disabled"),P.classList.add("disabled")),"isStopProcess"!==e&&"isEndProcess"!==e||(i.classList.remove("disabled"),a.classList.remove("disabled"),o.classList.remove("disabled"),s.classList.remove("disabled"),s.disabled=!1,r.classList.remove("disabled"),l.classList.remove("disabled"),u.classList.remove("disabled"),document.getElementById("progress-planner").value=0,m?x.classList.remove("disabled"):x.classList.add("disabled"),w.classList.add("disabled"),E.classList.add("disabled"),z.classList.remove("disabled"),G.classList.remove("disabled"),B.classList.remove("disabled"),k.classList.remove("disabled"),M.classList.remove("disabled"),T.classList.remove("disabled"),S.classList.remove("disabled"),C.classList.remove("disabled"),H.classList.remove("disabled"),R.classList.remove("disabled"),P.classList.remove("disabled")),!0}function c(e){var t=parseFloat(e.x),n=parseFloat(e.y),i=parseFloat(e.z);return/^\-?[0-9]+([\.][0-9]*\d)?$/.test(t)&&/^\-?[0-9]+([\.][0-9]*\d)?$/.test(n)&&/^\-?[0-9]+([\.][0-9]*\d)?$/.test(i)&&(E.x.textContent=e.x,E.y.textContent=e.y,E.z.textContent=e.z),!0}function d(e,t){}function l(e,t){var i=document.getElementById("box-milling"),a=document.getElementById("span-milling-tool"),o=document.getElementById("icon-milling-type"),s=document.getElementById("span-milling-feed-rate");if("isUpdate"===e){t=t.replace("(","").replace(")","");var r=t.split("|");3===r.length&&(i.classList.remove("hide"),a.textContent=r[0],s.textContent=n.string.format("{0} mm/sec",[r[2]]),(r[1].toLowerCase().contains("cut")||r[1].toLowerCase().contains("cortar"))&&(o.className="icon-milling-cut"),(r[1].toLowerCase().contains("drill")||r[1].toLowerCase().contains("furar"))&&(o.className="icon-milling-drill"),(r[1].toLowerCase().contains("deepen")||r[1].toLowerCase().contains("aprofundar"))&&(o.className="icon-milling-deepen"),(r[1].toLowerCase().contains("engrave")||r[1].toLowerCase().contains("gravar"))&&(o.className="icon-milling-engrave"))}"isClosed"!==e&&"isEnd"!==e||i.classList.add("hide")}function g(){function t(t){var a=document.getElementById("list-devices").querySelectorAll("li");[].forEach.call(a,function(e){e.classList.contains("device-empty")||e.parentNode.removeChild(e)}),e.engine.list().then(function(e){return e.length>0?(document.getElementById("list-devices").querySelector("li:first-child").classList.add("hide"),e.forEach(function(e){document.getElementById("list-devices").appendChild(n(e,function(e){e&&i.close()}))})):document.getElementById("list-devices").querySelector("li:first-child").classList.remove("hide"),!t||t(!0)})}function n(t,n){var i=document.createElement("li"),a=document.createElement("div"),o=document.createElement("i"),s=document.createElement("strong");return o.classList.add("icon-device"),o.style.verticalAlign="middle",s.style.position="relative",s.style.marginLeft="5px",s.style.top="2px",s.textContent=t.comName,a.appendChild(o),a.appendChild(s),i.dataset.devicePath=t.comName,i.classList.add("text-center"),i.appendChild(a),i.onclick=function(){e.engine.connect(this.dataset.devicePath,115200,"Grbl").then(function(e){return n(e)})},i}var i=document.getElementById("dialog-devices");document.getElementById("button-connection").onclick=function(){"Conectado"!==document.getElementById("strong-connection-status").textContent?t(function(e){if(e)return i.showModal()}):e.engine.disconnect()},document.getElementById("button-devices-close").onclick=function(e){i.close()}}function f(){var t=document.getElementById("dialog-settings");document.getElementById("button-settings-close").onclick=function(){t.close()},document.getElementById("button-settings-open").onclick=function(){this.classList.contains("disabled")||(e.device.commands.execute("$$",!0),setTimeout(function(){var n=e.device.settings,i=document.getElementById("text-setting-step-x"),a=document.getElementById("text-setting-step-y"),o=document.getElementById("text-setting-step-z"),s=document.getElementById("text-setting-feed-rate-x"),r=document.getElementById("text-setting-feed-rate-y"),c=document.getElementById("text-setting-feed-rate-z"),d=document.getElementById("text-setting-accel-x"),l=document.getElementById("text-setting-accel-y"),m=document.getElementById("text-setting-accel-z");i.value=n.stepX,a.value=n.stepY,o.value=n.stepZ,s.value=n.feedRateX,r.value=n.feedRateY,c.value=n.feedRateZ,d.value=n.accelX,l.value=n.accelY,m.value=n.accelZ,t.showModal()},450))},document.getElementById("button-settings-save").onclick=function(n){var i=document.getElementById("text-setting-step-x"),a=document.getElementById("text-setting-step-y"),o=document.getElementById("text-setting-step-z"),s=document.getElementById("text-setting-feed-rate-x"),r=document.getElementById("text-setting-feed-rate-y"),c=document.getElementById("text-setting-feed-rate-z"),d=document.getElementById("text-setting-accel-x"),l=document.getElementById("text-setting-accel-y"),m=document.getElementById("text-setting-accel-z"),u=document.getElementById("text-setting-correction-x"),p=document.getElementById("text-setting-correction-y"),g=document.getElementById("text-setting-correction-z");""!==i.value&&""!==a.value&&""!==o.value&&""!==d.value&&""!==l.value&&""!==m.value&&""!==s.value&&""!==r.value&&""!==c.value&&/^[0-9]+([\.][0-9]+)?$/.test(i.value)&&/^[0-9]+([\.][0-9]+)?$/.test(a.value)&&/^[0-9]+([\.][0-9]+)?$/.test(o.value)&&/^[0-9]+([\.][0-9]+)?$/.test(d.value)&&/^[0-9]+([\.][0-9]+)?$/.test(l.value)&&/^[0-9]+([\.][0-9]+)?$/.test(m.value)&&/^[0-9]+([\.][0-9]+)?$/.test(s.value)&&/^[0-9]+([\.][0-9]+)?$/.test(s.value)&&/^[0-9]+([\.][0-9]+)?$/.test(s.value)&&(setTimeout(function(){e.device.commands.execute("$100="+i.value,!0),setTimeout(function(){e.device.commands.execute("$101="+a.value,!0)},50),setTimeout(function(){e.device.commands.execute("$102="+o.value,!0)},120)},100),setTimeout(function(){e.device.commands.execute("$110="+s.value,!0),setTimeout(function(){e.device.commands.execute("$111="+r.value,!0)},50),setTimeout(function(){e.device.commands.execute("$112="+c.value,!0)},120)},200),setTimeout(function(){e.device.commands.execute("$120="+d.value,!0),setTimeout(function(){e.device.commands.execute("$121="+l.value,!0)},50),setTimeout(function(){e.device.commands.execute("$122="+m.value,!0)},120),t.close()},300))},t.addEventListener("close",function(){})}function h(){var e=document.getElementById("dialog-help");document.getElementById("button-help-close").onclick=function(){e.close()},document.getElementById("button-help-open").onclick=function(){e.showModal()}}function y(){var e=document.getElementById("dialog-probe-settings");document.getElementById("button-probe-settings-close").onclick=function(){e.close()},document.getElementById("button-probe-settings-save").onclick=function(){e.close()},document.getElementById("icon-probe-settings").onclick=function(){this.classList.contains("disabled")||e.showModal()}}function v(){var e=document.getElementById("dialog-donation");document.getElementById("button-donation-close").onclick=function(){e.close()},document.getElementById("button-donation-open").onclick=function(){e.showModal()}}var b=null,x=null,w={duration:1,interval:[]},E={x:null,y:null,z:null},L={work:{x:"0.000",y:"0.000",z:"0.000"},machine:{x:"0.000",y:"0.000",z:"0.000"}},I=null,z=require("electron").shell;e.interface={_initialize:function e(){return i(),a(),g(),f(),h(),f(),y(),v(),SkinnyTip.init(),r("isDisconnected"),!0},_reset:function e(){},file:s,tool:d,status:r,milling:l,position:c,update:function e(t){return!0},get state(){return I}}}(c37.application.controller,c37.library.moment,c37.library.utility),function(e,t){var n={name:"",gcode:"",remain:[],sent:[],received:0,total:0,streaming:{bufferSize:125,queue:[]},createdTime:0,startedTime:0,finishedTime:0};t.object.namespace(e,"firmware.grbl.sender"),e.firmware.grbl.sender={load:function e(t,i){return n.name=t,n.gcode=i,n.remain=i.split("\n").filter(function(e){return e.trim().length>0}),n.sent=[],n.received=0,n.total=n.remain.length,n.streaming.queue=[],n.createdTime=(new Date).getTime(),n.startedTime=0,n.finishedTime=0,!0},unload:function e(){n.name="",n.gcode="",n.remain=[],n.sent=0,n.received=0,n.total=0,n.streaming.queue=[],n.createdTime=0,n.startedTime=0,n.finishedTime=0},get state(){return n},next:function e(t){if(0!==n.remain.length||0!==n.sent.length){for(n.remain.length>0&&0===n.sent.length&&(n.startedTime=(new Date).getTime());n.remain.length>0;){var a=i(n.remain.shift()).trim(),o=n.streaming.queue.join("").length;if(a.length+o>=n.streaming.bufferSize){n.remain.unshift(a);break}n.sent.push(a),t.write(a+"\n"),document.getElementById("progress-planner").value=o,a.length>0?n.streaming.queue.push(a):this.ack()}0===n.remain.length&&(n.finishedTime=(new Date).getTime())}},responseNext:function e(t){n.streaming.queue.shift(),this.next(t)},rewind:function e(){n.sent=0,n.remain=0,n.streaming.queue=[],n.received=0,n.startedTime=0,n.finishedTime=0},ack:function e(){n.received++}};var i=function(){var e=new RegExp(/\s*[%#;].*/g),t=new RegExp(/\s*\([^\)]*\)/g);return function(n){return n.replace(e,"").replace(t,"")}}()}(c37.application.controller,c37.library.utility),function(t,n){var i=[{group:"motion",modes:["G0","G1","G2","G3","G38.2","G38.3","G38.4","G38.5","G80"]},{group:"coordinate",modes:["G54","G55","G56","G57","G58","G59"]},{group:"plane",modes:["G17","G18","G19"]},{group:"units",modes:["G20","G21"]},{group:"distance",modes:["G90","G91"]},{group:"feedrate",modes:["G93","G94"]},{group:"program",modes:["M0","M1","M2","M30"]},{group:"spindle",modes:["M3","M4","M5"]},{group:"coolant",modes:["M7","M8","M9"]}];n.object.namespace(t,"firmware.grbl.message"),t.firmware.grbl.message={parse:function e(t){var n=!0,i=!1,a=void 0;try{for(var o=x[Symbol.iterator](),s;!(n=(s=o.next()).done);n=!0){var r=s.value,c=r.parse(t);if(c)return _.set(c,"payload.raw",t),c}}catch(e){i=!0,a=e}finally{try{!n&&o.return&&o.return()}finally{if(i)throw a}}return{type:null,payload:{raw:t}}}};var a=function(){function t(){e(this,t)}return c(t,null,[{key:"parse",value:function e(t){var n=t.match(/^<(.+)>/);if(!n)return null;var i={},a=/[a-zA-Z]+(:[0-9\.\-]+(,[0-9\.\-]+){0,5})?/g,o=n[1].match(a),s={},r=(o.shift()||"").split(":");i.activeState=r[0]||"",i.subState=Number(r[1]||"");var c=!0,d=!1,l=void 0;try{for(var m=o[Symbol.iterator](),u;!(c=(u=m.next()).done);c=!0){var p=u.value,g=p.match(/^(.+):(.+)/);if(g){var f=g[1],h=g[2].split(",");s[f]=h}}}catch(e){d=!0,l=e}finally{try{!c&&m.return&&m.return()}finally{if(d)throw l}}if(_.has(s,"MPos")){var y=["x","y","z","a","b","c"],v=_.get(s,"MPos",["0.000","0.000","0.000"]);i.mpos={};for(var b=0;b<v.length;++b)i.mpos[y[b]]=v[b]}if(_.has(s,"WPos")){var x=["x","y","z","a","b","c"],w=_.get(s,"WPos",["0.000","0.000","0.000"]);i.wpos={};for(var E=0;E<w.length;++E)i.wpos[x[E]]=w[E]}if(_.has(s,"WCO")){var L=["x","y","z","a","b","c"],I=_.get(s,"WCO",["0.000","0.000","0.000"]);i.wco={};for(var z=0;z<I.length;++z)i.wco[L[z]]=I[z]}if(_.has(s,"Buf")&&(i.buf=i.buf||{},i.buf.planner=Number(_.get(s,"Buf[0]",0))),_.has(s,"RX")&&(i.buf=i.buf||{},i.buf.rx=Number(_.get(s,"RX[0]",0))),_.has(s,"Bf")&&(i.buf=i.buf||{},i.buf.planner=Number(_.get(s,"Bf[0]",0)),i.buf.rx=Number(_.get(s,"Bf[1]",0))),_.has(s,"Ln")&&(i.ln=Number(_.get(s,"Ln[0]",0))),_.has(s,"F")&&(i.feedrate=Number(_.get(s,"F[0]",0))),_.has(s,"FS")&&(i.feedrate=Number(_.get(s,"FS[0]",0)),i.spindle=Number(_.get(s,"FS[1]",0))),_.has(s,"Lim")){var G=Number(_.get(s,"Lim[0]",0));i.pinState=[1&G?"X":"",2&G?"Y":"",4&G?"Z":"",4&G?"A":""].join("")}return _.has(s,"Pn")&&(i.pinState=_.get(s,"Pn[0]","")),_.has(s,"Ov")&&(i.ov=_.get(s,"Ov",[]).map(function(e){return Number(e)})),_.has(s,"A")&&(i.accessoryState=_.get(s,"A[0]","")),{type:"Status",payload:i}}}]),t}(),o=function(){function t(){e(this,t)}return c(t,null,[{key:"parse",value:function e(t){var n=t.match(/^ok/);if(!n)return null;var i={};return{type:"Ok",payload:i}}}]),t}(),r=function(){function t(){e(this,t)}return c(t,null,[{key:"parse",value:function e(t){var n=t.match(/^error:\s*(.+)/);if(!n)return null;var i={message:n[1]};return{type:"Error",payload:i}}}]),t}(),d=function(){function t(){e(this,t)}return c(t,null,[{key:"parse",value:function e(t){var n=t.match(/^ALARM:\s*(.+)$/);if(!n)return null;var i={message:n[1]};return{type:"Alarm",payload:i}}}]),t}(),l=function(){function t(){e(this,t)}return c(t,null,[{key:"parse",value:function e(t){var n=t.match(/^\[(?:GC:)?((?:[a-zA-Z][0-9]+(?:\.[0-9]*)?\s*)+)\]$/);if(!n)return null;var a={},o=_(n[1].split(" ")).compact().map(function(e){return _.trim(e)}).value();return o.forEach(function(e){if(0===e.indexOf("G")||0===e.indexOf("M")){var t=_.find(i,function(t){return _.includes(t.modes,e)});t&&_.set(a,"modal."+t.group,e)}0===e.indexOf("T")&&_.set(a,"tool",e.substring(1)),0===e.indexOf("F")&&_.set(a,"feedrate",e.substring(1)),0===e.indexOf("S")&&_.set(a,"spindle",e.substring(1))}),{type:"State",payload:a}}}]),t}(),m=function(){function t(){e(this,t)}return c(t,null,[{key:"parse",value:function e(t){var n=t.match(/^\[(G54|G55|G56|G57|G58|G59|G28|G30|G92|TLO|PRB):(.+)\]$/);if(!n)return null;var i=n[1],a=n[2],o={name:i,value:""},r=/^G\d+$/i;if(r.test(i)){var c=["x","y","z","a","b","c"],d=a.split(",");o.value={};for(var l=0;l<d.length;++l)o.value[c[l]]=d[l]}if("TLO"===i&&(o.value=a),"PRB"===i){var c=["x","y","z","a","b","c"],m=a.split(":"),u=s(m,2),p=u[0],g=u[1],d=p.split(",");o.value={},o.value.result=Number(g);for(var f=0;f<d.length;++f)o.value[c[f]]=d[f]}return{type:"Parameters",payload:o}}}]),t}(),u=function(){function t(){e(this,t)}return c(t,null,[{key:"parse",value:function e(t){var n=t.match(/^\[(?:HLP:)?(.+)\]$/);if(!n)return null;var i={message:n[1]};return{type:"Help",payload:i}}}]),t}(),p=function(){function t(){e(this,t)}return c(t,null,[{key:"parse",value:function e(t){var n=t.match(/^\[(?:VER:)?(.+)\]$/);if(!n)return null;var i={message:n[1]};return{type:"Version",payload:i}}}]),t}(),g=function(){function t(){e(this,t)}return c(t,null,[{key:"parse",value:function e(t){var n=t.match(/^\[(?:OPT:)?(.+)\]$/);if(!n)return null;var i={message:n[1]};return{type:"Option",payload:i}}}]),t}(),f=function(){function t(){e(this,t)}return c(t,null,[{key:"parse",value:function e(t){var n=t.match(/^\[(?:echo:)?(.+)\]$/);if(!n)return null;var i={message:n[1]};return{type:"Echo",payload:i}}}]),t}(),h=function(){function t(){e(this,t)}return c(t,null,[{key:"parse",value:function e(t){var n=t.match(/^\[(?:MSG:)?(.+)\]$/);if(!n)return null;var i={message:n[1]};return{type:"Feedback",payload:i}}}]),t}(),y=function(){function t(){e(this,t)}return c(t,null,[{key:"parse",value:function e(t){var n=t.match(/^(\$[^=]+)=([^ ]*)\s*(.*)/);if(!n)return null;var i={name:n[1],value:n[2],message:_.trim(n[3],"()")};return{type:"Settings",payload:i}}}]),t}(),v=function(){function t(){e(this,t)}return c(t,null,[{key:"parse",value:function e(t){var n=t.match(/^Grbl\s*(\d+\.\d+[a-zA-Z]?)/);if(!n)return null;var i={version:n[1]};return{type:"Startup",payload:i}}}]),t}(),b=function(){function t(){e(this,t)}return c(t,null,[{key:"parse",value:function e(t){var n=t.match(/^\[Pgm End\]/);if(!n)return null;var i={};return{type:"Pgm End",payload:i}}}]),t}(),x=[a,o,r,d,l,m,u,p,g,f,h,y,v,b]}(c37.application.controller,c37.library.utility),function(e,t){t.object.namespace(e,"firmware.grbl.constants"),e.firmware.grbl.constants={GRBL:"Grbl",STATE:{IDLE:"Idle",RUN:"Run",HOLD:"Hold",DOOR:"Door",HOME:"Home",SLEEP:"Sleep",ALARM:"Alarm",CHECK:"Check"},REALTIME_COMMANDS:["~","!","?",""],MODAL_GROUPS:[{group:"motion",modes:["G0","G1","G2","G3","G38.2","G38.3","G38.4","G38.5","G80"]},{group:"coordinate",modes:["G54","G55","G56","G57","G58","G59"]},{group:"plane",modes:["G17","G18","G19"]},{group:"units",modes:["G20","G21"]},{group:"distance",modes:["G90","G91"]},{group:"feedrate",modes:["G93","G94"]},{group:"program",modes:["M0","M1","M2","M30"]},{group:"spindle",modes:["M3","M4","M5"]},{group:"coolant",modes:["M7","M8","M9"]}],ERRORS:[{code:1,description:"Expected command letter",help:"G-code words consist of a letter and a value. Letter was not found."},{code:2,description:"Bad number format",help:"Missing the expected G-code word value or numeric value format is not valid."},{code:3,description:"Invalid statement",help:"Grbl $' system command was not recognized or supported."},{code:4,description:"Value < 0",help:"Negative value received for an expected positive value."},{code:5,description:"Setting disabled",help:"Homing cycle failure. Homing is not enabled via settings."},{code:6,description:"Value < 3 usec",help:"Minimum step pulse time must be greater than 3usec."},{code:7,description:"EEPROM read fail. Using defaults",help:"An EEPROM read failed. Auto-restoring affected EEPROM to default values."},{code:8,description:"Not idle",help:"Grbl '$' command cannot be used unless Grbl is IDLE. Ensures smooth operation during a job."},{code:9,description:"G-code lock",help:"G-code commands are locked out during alarm or jog state."},{code:10,description:"Homing not enabled",help:"Soft limits cannot be enabled without homing also enabled."},{code:11,description:"Line overflow",help:"Max characters per line exceeded. Received command line was not executed."},{code:12,description:"Step rate > 30kHz",help:"Grbl '$' setting value cause the step rate to exceed the maximum supported."},{code:13,description:"Check Door",help:"Safety door detected as opened and door state initiated."},{code:14,description:"Line length exceeded",help:"Build info or startup line exceeded EEPROM line length limit. Line not stored."},{code:15,description:"Travel exceeded",help:"Jog target exceeds machine travel. Jog command has been ignored."},{code:16,description:"Invalid jog command",help:"Jog command has no '=' or contains prohibited g-code."},{code:20,description:"Unsupported command",help:"Unsupported or invalid g-code command found in block."},{code:21,description:"Modal group violation",help:"More than one g-code command from same modal group found in block."},{code:22,description:"Undefined feed rate",help:"Feed rate has not yet been set or is undefined."},{code:23,description:"Invalid gcode ID:23",help:"G-code command in block requires an integer value."},{code:24,description:"Invalid gcode ID:24",help:"More than one g-code command that requires axis words found in block."},{code:25,description:"Invalid gcode ID:25",help:"Repeated g-code word found in block."},{code:26,description:"Invalid gcode ID:26",help:"No axis words found in block for g-code command or current modal state which requires them."},{code:27,description:"Invalid gcode ID:27",help:"Line number value is invalid."},{code:28,description:"Invalid gcode ID:28",help:"G-code command is missing a required value word."},{code:29,description:"Invalid gcode ID:29",help:"G59.x work coordinate systems are not supported."},{code:30,description:"Invalid gcode ID:30",help:"G53 only allowed with G0 and G1 motion modes."},{code:31,description:"Invalid gcode ID:31",help:"Axis words found in block when no command or current modal state uses them."},{code:32,description:"Invalid gcode ID:32",help:"G2 and G3 arcs require at least one in-plane axis word."},{code:33,description:"Invalid gcode ID:33",help:"Motion command target is invalid."},{code:34,description:"Invalid gcode ID:34",help:"Arc radius value is invalid."},{code:35,description:"Invalid gcode ID:35",help:"G2 and G3 arcs require at least one in-plane offset word."},{code:36,description:"Invalid gcode ID:36",help:"Unused value words found in block."},{code:37,description:"Invalid gcode ID:37",help:"G43.1 dynamic tool length offset is not assigned to configured tool length axis."},{code:38,description:"Invalid gcode ID:38",help:"Tool number greater than max supported value."}],ALARMS:[{code:1,description:"Hard limit",help:"Hard limit has been triggered. Machine position is likely lost due to sudden halt. Re-homing is highly recommended."},{code:2,description:"Soft limit",help:"Soft limit alarm. G-code motion target exceeds machine travel. Machine position retained. Alarm may be safely unlocked."},{code:3,description:"Abort during cycle",help:"Reset while in motion. Machine position is likely lost due to sudden halt. Re-homing is highly recommended."},{code:4,description:"Probe fail",help:"Probe fail. Probe is not in the expected initial state before starting probe cycle when G38.2 and G38.3 is not triggered and G38.4 and G38.5 is triggered."},{code:5,description:"Probe fail",help:"Probe fail. Probe did not contact the workpiece within the programmed travel for G38.2 and G38.4."},{code:6,description:"Homing fail",help:"Homing fail. The active homing cycle was reset."},{code:7,description:"Homing fail",help:"Homing fail. Safety door was opened during homing cycle."},{code:8,description:"Homing fail",help:"Homing fail. Pull off travel failed to clear limit switch. Try increasing pull-off setting or check wiring."},{code:9,description:"Homing fail",help:"Homing fail. Could not find limit switch within search distances. Try increasing max travel, decreasing pull-off distance, or check wiring."}],SETTINGS:[{setting:"$0",description:"Step pulse time",units:"microseconds",help:"Sets time length per step. Minimum 3usec."},{setting:"$1",description:"Step idle delay",units:"milliseconds",help:"Sets a short hold delay when stopping to let dynamics settle before disabling steppers. Value 255 keeps motors enabled with no delay."},{setting:"$2",description:"Step pulse invert",units:"mask",help:"Inverts the step signal. Set axis bit to invert (00000ZYX)."},{setting:"$3",description:"Step direction invert",units:"mask",help:"Inverts the direction signal. Set axis bit to invert (00000ZYX)."},{setting:"$4",description:"Invert step enable pin",units:"boolean",help:"Inverts the stepper driver enable pin signal."},{setting:"$5",description:"Invert limit pins",units:"boolean",help:"Inverts the all of the limit input pins."},{setting:"$6",description:"Invert probe pin",units:"boolean",help:"Inverts the probe input pin signal."},{setting:"$10",description:"Status report options",units:"mask",help:"Alters data included in status reports."},{setting:"$11",description:"Junction deviation",units:"millimeters",help:"Sets how fast Grbl travels through consecutive motions. Lower value slows it down."},{setting:"$12",description:"Arc tolerance",units:"millimeters",help:"Sets the G2 and G3 arc tracing accuracy based on radial error. Beware: A very small value may effect performance."},{setting:"$13",description:"Report in inches",units:"boolean",help:"Enables inch units when returning any position and rate value that is not a settings value."},{setting:"$20",description:"Soft limits enable",units:"boolean",help:"Enables soft limits checks within machine travel and sets alarm when exceeded. Requires homing."},{setting:"$21",description:"Hard limits enable",units:"boolean",help:"Enables hard limits. Immediately halts motion and throws an alarm when switch is triggered."},{setting:"$22",description:"Homing cycle enable",units:"boolean",help:"Enables homing cycle. Requires limit switches on all axes."},{setting:"$23",description:"Homing direction invert",units:"mask",help:"Homing searches for a switch in the positive direction. Set axis bit (00000ZYX) to search in negative direction."},{setting:"$24",description:"Homing locate feed rate",units:"mm/min",help:"Feed rate to slowly engage limit switch to determine its location accurately."},{setting:"$25",description:"Homing search seek rate",units:"mm/min",help:"Seek rate to quickly find the limit switch before the slower locating phase."},{setting:"$26",description:"Homing switch debounce delay",units:"milliseconds",help:"Sets a short delay between phases of homing cycle to let a switch debounce."},{setting:"$27",description:"Homing switch pull-off distance",units:"millimeters",help:"Retract distance after triggering switch to disengage it. Homing will fail if switch isn't cleared."},{setting:"$30",description:"Maximum spindle speed",units:"RPM",help:"Maximum spindle speed. Sets PWM to 100% duty cycle."},{setting:"$31",description:"Minimum spindle speed",units:"RPM",help:"Minimum spindle speed. Sets PWM to 0.4% or lowest duty cycle."},{setting:"$32",description:"Laser-mode enable",units:"boolean",help:"Enables laser mode. Consecutive G1/2/3 commands will not halt when spindle speed is changed."},{setting:"$100",description:"X-axis travel resolution",units:"step/mm",help:"X-axis travel resolution in steps per millimeter."},{setting:"$101",description:"Y-axis travel resolution",units:"step/mm",help:"Y-axis travel resolution in steps per millimeter."},{setting:"$102",description:"Z-axis travel resolution",units:"step/mm",help:"Z-axis travel resolution in steps per millimeter."},{setting:"$110",description:"X-axis maximum rate",units:"mm/min",help:"X-axis maximum rate. Used as G0 rapid rate."},{setting:"$111",description:"Y-axis maximum rate",units:"mm/min",help:"Y-axis maximum rate. Used as G0 rapid rate."},{setting:"$112",description:"Z-axis maximum rate",units:"mm/min",help:"Z-axis maximum rate. Used as G0 rapid rate."},{setting:"$120",description:"X-axis acceleration",units:"mm/sec^2",help:"X-axis acceleration. Used for motion planning to not exceed motor torque and lose steps."},{setting:"$121",description:"Y-axis acceleration",units:"mm/sec^2",help:"Y-axis acceleration. Used for motion planning to not exceed motor torque and lose steps."},{setting:"$122",description:"Z-axis acceleration",units:"mm/sec^2",help:"Z-axis acceleration. Used for motion planning to not exceed motor torque and lose steps."},{setting:"$130",description:"X-axis maximum travel",units:"millimeters",help:"Maximum X-axis travel distance from homing switch. Determines valid machine space for soft-limits and homing search distances."},{setting:"$131",description:"Y-axis maximum travel",units:"millimeters",help:"Maximum Y-axis travel distance from homing switch. Determines valid machine space for soft-limits and homing search distances."},{setting:"$132",description:"Z-axis maximum travel",units:"millimeters",help:"Maximum Z-axis travel distance from homing switch. Determines valid machine space for soft-limits and homing search distances."}]}}(c37.application.controller,c37.library.utility),function(e,t){var n=null,i=null,a=null,o={timer:null,status:!0},s={busy:!1},r=null,c=!1,d=!1,l={IDLE:"Idle",RUN:"Run",HOLD:"Hold",ALARM:"Alarm"};t.object.namespace(e,"firmware.grbl.controller"),e.firmware.grbl.controller={initialize:function t(m){return n=m,i=e.firmware.grbl.sender,a=e.firmware.grbl.message,n.on("data",function(t){var m=a.parse(t);return console.log(m),"Startup"===m.type?(d||(e.interface.status("isConnected"),d=!0),setTimeout(function(){c=!0},200),void(o.status=!1)):"Status"===m.type?(o.status=!1,e.viewer.position(m.payload.wpos),e.interface.position(m.payload.wpos),r=m.payload.activeState,r===l.IDLE&&i.state.remain.length<=0&&i.state.finishedTime>0&&(e.interface.status("isEndProcess"),i.rewind(),n.write("M5\n")),void(r===l.HOLD&&e.interface.status("isPauseProcess"))):"Ok"===m.type?(s.busy=!1,void(i.state.remain.length>0&&i.state.sent.length>0&&i.responseNext(n))):void("Error"===m.type&&console.log(m))}),n.on("error",function(e){console.error(e)}),n.on("close",function(t){clearInterval(o.timer),e.interface.status("isDisconnected")}),this},open:function e(){return new Promise(function(e,t){n.open(function(i){return i?t(!1):(d=!1,o.timer=setInterval(function(){n.isOpen()&&c&&(o.status||(o.status=!0,n.write("?")))},250),e(!0))})})},close:function t(){return new Promise(function(t,i){n.close(function(n){return n?i(!1):(clearInterval(o.timer),e.interface.status("isDisconnected"),t(!0))})})},get status(){return""},get state(){return r},set state(e){r=e},get workFlowState(){return l},command:function e(t,a,o){var r={load:function e(t){return i.load(t.name,t.gcode),!o||o(!0)},start:function e(t){return i.next(n),!o||o(!0)},pause:function e(t){return n.write("!"),!o||o(!0)},resume:function e(t){return n.write("~"),setTimeout(function(){i.next(n)},30),!o||o(!0)},stop:function e(){i.rewind(),c=!1,d=!0,n.write("!"),setTimeout(function(){return n.write(""),!o||o(!0)},300)},reset:function e(){n.write("")},gcode:function e(t){if(!s.busy)return s.busy=!0,n.write(t+"\n"),console.log(t),!o||o(!0)}};r[t](a)},dispose:function e(){}}}(c37.application.controller,c37.library.utility);